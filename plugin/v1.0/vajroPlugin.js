var vajroPlugin;(()=>{"use strict";var t={d:(e,n)=>{for(var i in n)t.o(n,i)&&!t.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:n[i]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{flow:()=>y,showMessage:()=>v});var n=function(t){var e=t.overAll,n=t.getProductValid,i=t.getProductVariantIds,u=t.buyProductVariantIds,r=t.sanitizedLineItem,o=t.discountType,a=t.discountValue,c=a,d=0,l=n?i:u,s=e?Object.values(r):l;return s.forEach((function(t){var n=e?t:r[t],i=n.unitPrice,u=n.quantity;d+=i*u})),s.map((function(t){var n=e?t:r[t],i=n.unitPrice,u=n.quantity,l=n.variantId,s=n.productId,v=n.lineItemHandle;if("percentage"===o)return a>=100&&(c=100),{productId:s,variantId:l,quantity:u,unitPrice:(u*i-u*i*(c/100))/u,lineItemHandle:v,discountType:o,discountValue:c};var y=u*i/d*100/100*a;return{productId:s,variantId:l,quantity:u,unitPrice:(u*i-y)/u,lineItemHandle:v,discountType:o,discountValue:y}}))},i=function(t){var e=t.offerCategory,n=t.getCollectionValid,i=t.buyCollections,u=t.buyCollectionsCount,r=t.getCollections,o=t.getCollectionsCount,a=t.sanitizedLineItem,c=[],d=[],l=0,s=0;return n&&r.split(",").forEach((function(t){t&&Object.values(a).forEach((function(e){var n=e.collectionId,i=e.variantId,u=e.quantity;n===t&&(s+=u,d.push(i))}))})),i.split(",").forEach((function(t){t&&Object.values(a).forEach((function(e){var n=e.collectionId,i=e.variantId,u=e.quantity;n===t&&(l+=u,c.push(i))}))})),"volumeDiscount"===e?(n?s>=o&&l>=u:l>=u)?{buyCollectionsIdsValid:c,getCollectionsIdsValid:d}:{}:{buyCollectionsIdsValid:c,getCollectionsIdsValid:d}},u=function(t){var e=t.getCollectionValue,n=t.buyCollectionValue,i=t.sanitizedLineItem,u=t.discountType,r=t.discountValue,o=r,a=0,c=[];if(e){var d=e.buyCollectionsIdsValid,l=e.getCollectionsIdsValid;d&&d.length>0&&l&&l.length>0&&(c=d.concat(l))}else(d=n.buyCollectionsIdsValid)&&d.length>0&&(c=d);return c.forEach((function(t){var e=i[t].unitPrice;a+=e})),c.map((function(t){var e=i[t],n=e.unitPrice,c=e.quantity,d=e.variantId,l=e.productId;return"percentage"===u?(r>=100&&(o=100),{productId:l,variantId:d,quantity:c,unitPrice:(c*n-c*n*(o/100))/c}):{productId:l,variantId:d,quantity:c,unitPrice:n-n/a*100/100*r}}))},r=function(t){var e=t.buyProducts,n=t.sanitizedLineItem;return!!e.every((function(t){var e=t.variantId,i=t.count;return!!e&&n[e].quantity>=i}))},o=function(t){var e=t.getProducts,n=t.sanitizedLineItem;return e.map((function(t){var e=t.productId,i=t.variantId,u=t.count,r=n[i].quantity>=u,o=r?0:n[i].unitPrice,a={productId:e,variantId:i,quantity:n[i].quantity,unitPrice:o,lineItemHandle:n[i].lineItemHandle,discountType:"free",discountValue:n[i].unitPrice};return r?a:null}))},a=function(t){var e=t.cartQuantity,n=t.sanitizedLineItem,i=0;return Object.values(n).forEach((function(t){var e=t.quantity;i+=e})),i>=e},c=function(t){var e=t.getProducts,n=t.sanitizedLineItem,i=t.discountType,u=t.discountValue,r=0;return e.forEach((function(t){var e=t.variantId,i=n[e],u=i.unitPrice,o=i.quantity;r+=u*o})),e.map((function(t){var e=t.variantId,o=t.amount,a=u,c=n[e].unitPrice*n[e].quantity>=o,d=n[e],l=d.unitPrice,s=d.quantity,v=d.productId,y=d.lineItemHandle;if(c){if("percentage"===i)return u>=100&&(a=100),{productId:v,variantId:e,quantity:s,unitPrice:(s*l-s*l*(a/100))/s,lineItemHandle:y,discountType:i,discountValue:a};var f=s*l/r*100/100*u;return{productId:v,variantId:e,quantity:s,unitPrice:(s*l-f)/s,lineItemHandle:y,discountType:i,discountValue:f}}}))},d=function(t){switch(t.offerCategory){case"percentageDiscount":case"flatDiscount":return function(t){return function(t){var e=t.lineItems,r=t.getRemovedProductList,o=t.offerCategory,a=t.overAll,c=t.getProductValid,d=t.getCollectionValid,l=t.collection,s=t.discountType,v=t.discountValue,y=t.buyCollections,f=t.buyCollectionsCount,I=t.getCollections,m=t.getCollectionsCount,P=t.buyProducts,g=t.getProducts,p=P.flatMap((function(t){return t.variantId})),L=g.flatMap((function(t){return t.variantId})),b=e;if(a)return{output:O=n({overAll:a,sanitizedLineItem:b,discountType:s,discountValue:v}),getRemovedProductList:r};if(l){if(l){var C=!!d&&i({offerCategory:o,getCollectionValid:d,buyCollections:y,getCollections:I,buyCollectionsCount:f,getCollectionsCount:m,sanitizedLineItem:b}),V=!d&&i({offerCategory:o,buyCollections:y,buyCollectionsCount:f,sanitizedLineItem:b}),z=d?u({getCollectionValue:C,sanitizedLineItem:b,discountType:s,discountValue:v}):[],T=d?[]:u({buyCollectionValue:V,sanitizedLineItem:b,discountType:s,discountValue:v});return{getRemovedProductList:r,output:d?z:T}}return{getRemovedProductList:r,output:{}}}var q=!!c&&function(t){var e=t.getProducts,n=t.sanitizedLineItem,i=t.buyProducts.every((function(t){var e=t.variantId,i=t.count;return n[e]&&n[e].quantity>=i})),u=e.every((function(t){var e=t.variantId,i=t.count;return n[e]&&n[e].quantity>=i}));return!(!i||!u)}({buyProducts:P,getProducts:g,sanitizedLineItem:b}),h=!c&&function(t){var e=t.sanitizedLineItem;return!!t.buyProducts.every((function(t){var n=t.variantId,i=t.count;return e[n]&&e[n].quantity>=i}))}({buyProducts:P,sanitizedLineItem:b}),R=c&&q?n({getProductValid:c,getProductVariantIds:L,sanitizedLineItem:b,discountType:s,discountValue:v}):[],O=!c&&h?n({getProductValid:c,buyProductVariantIds:p,sanitizedLineItem:b,discountType:s,discountValue:v}):[];return{output:c?R:O,getRemovedProductList:r}}(t)}(t);case"volumeDiscount":return function(t){var e=function(t){var e=t.lineItems,o=t.getRemovedProductList,c=t.overAll,d=t.cartQuantity,l=t.offerCategory,s=t.getCollectionValid,v=t.collection,y=t.discountType,f=t.discountValue,I=t.buyCollections,m=t.buyCollectionsCount,P=t.buyProducts,g=e;if(c)return{getRemovedProductList:o,output:a({cartQuantity:d,sanitizedLineItem:g})?n({overAll:c,sanitizedLineItem:g,discountType:y,discountValue:f}):[]};if(v){if(v){var p=!s&&i({offerCategory:l,buyCollections:I,buyCollectionsCount:m,sanitizedLineItem:g});return{getRemovedProductList:o,output:s?[]:u({buyCollectionValue:p,sanitizedLineItem:g,discountType:y,discountValue:f})}}return{getRemovedProductList:o,output:{}}}var L=P.flatMap((function(t){return t.variantId}));return{getRemovedProductList:o,output:r({buyProducts:P,sanitizedLineItem:g})?n({buyProductVariantIds:L,sanitizedLineItem:g,discountType:y,discountValue:f}):[]}}(t);return e}(t);case"buyXGetY":return function(t){var e=function(t){var e=t.lineItems,n=t.getRemovedProductList,i=t.onlyCartAmoutAndQunatity,u=t.cartQuantity,c=t.buyProducts,d=t.getProducts,l=e;return i?{getRemovedProductList:n,output:a({cartQuantity:u,sanitizedLineItem:l})?o({getProducts:d,sanitizedLineItem:l}):[]}:{getRemovedProductList:n,output:r({buyProducts:c,sanitizedLineItem:l})?o({getProducts:d,sanitizedLineItem:l}):[]}}(t);return e}(t);case"buyMoreSaveMore":return function(t){return function(t){var e=t.lineItems,n=t.getRemovedProductList,i=t.onlyCartAmoutAndQunatity,u=t.cartTotal,r=t.buyProducts,o=t.getProducts,a=t.discountType,d=t.discountValue,l=e;if(i){var s=function(t){var e=t.cartTotal,n=t.sanitizedLineItem,i=0;return Object.values(n).forEach((function(t){var e=t.unitPrice,n=t.quantity;i+=e*n})),i>=e}({cartTotal:u,sanitizedLineItem:l});return{getRemovedProductList:n,output:s?c({getProducts:o,sanitizedLineItem:l,discountType:a,discountValue:d}):[]}}var v=function(t){var e=t.sanitizedLineItem;return!!t.buyProducts.every((function(t){var n=t.variantId,i=t.amount;return!!n&&e[n].unitPrice*e[n].quantity>=i}))}({buyProducts:r,sanitizedLineItem:l});return{getRemovedProductList:n,output:v?c({getProducts:o,sanitizedLineItem:l,discountType:a,discountValue:d}):[]}}(t)}(t);default:return{}}},l=function(){return l=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var u in e=arguments[n])Object.prototype.hasOwnProperty.call(e,u)&&(t[u]=e[u]);return t},l.apply(this,arguments)},s=function(t){return t.reduce((function(t,e){return t[e.variantId]=e,t}),{})},v=function(t){return t},y=function(t,e){var n,i,u,r=t.cartLineItems,o=(void 0===r?{}:r).lineItems,a=(n=e,u=function(t){return t.filter((function(t){var e=t.lineItemType,n=t.originalUnitPrice;return t.unitPrice=n,"READONLY"===e}))}(i=void 0===o?[]:o)||[],i=function(t,e,n){var i=t.map((function(t){return t.variantId})),u=e.map((function(t){return t.variantId}));return n=s(n),i.forEach((function(t){var e=n[t]||{},i=e.lineItemType,u=e.variantId,r=e.originalUnitPrice;u===t&&"READONLY"===i&&(n[t].unitPrice=r)})),u.forEach((function(t){var e=n[t]||{},i=e.lineItemType,u=e.variantId,r=e.originalUnitPrice;u===t&&"READONLY"===i&&(n[t].unitPrice=r)})),n}(n.getProducts,n.buyProducts,i),l(l({},n),{lineItems:i,getRemovedProductList:u})),c=d(a);return JSON.stringify(c)};vajroPlugin=e})();
//# sourceMappingURL=vajroPlugin.js.map