var vajroPlugin;(()=>{"use strict";var t={d:(e,n)=>{for(var r in n)t.o(n,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:n[r]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{flow:()=>s,showMessage:()=>l});var n=function(){return n=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},n.apply(this,arguments)},r=function(t){return t.reduce((function(t,e){return t[e.variantId]=e,t}),{})},o=function(t){var e=t.cartType,n=t.cartValue,r=t.lineItems,o=function(t){var e=t.offerCategory,n=t.customBuyCollection,r=t.customGetCollection,o=t.customBuyProduct,u=t.customGetProduct,c=t.getProductCount,i=o.length>0||n.length>0?o.concat(n):[],a=0===c&&(u.length>0||r.length>0)?u.concat(r):[];return"automaticOffers"!==e?i.concat(a):i}(t),u=0;return o.forEach((function(t){if(t){var n=r.reduce((function(n,r){var o=r||{},u=o.collectionId,c=o.variantId,i=o.quantity,a=o.unitPrice;return c!==t&&u!==t||(n+="amount"===e?i*a:i),n}),0);u+=n}})),u>=n},u=function(t){var e=t.customGetProduct,n=t.getProductCount,r=t.lineItems,o=0;return e.forEach((function(t){if(t){var e=r.reduce((function(e,n){var r=n||{},o=r.collectionId,u=r.variantId,c=r.quantity;return u!==t&&o!==t||(e+=c),e}),0);o+=e}})),o>=n},c=function(t,e,n,r,o,u,c){var i=e||{},a=i.unitPrice,d=i.quantity,l=i.variantId,s=i.productId,v=i.lineItemHandle;if("percentage"===n)return{productId:s,variantId:l,quantity:d,unitPrice:(m=d*a-d*a*(o/100))/d,lineItemHandle:v,discountType:t,discountValue:"You got ".concat(o,"% off"),customLineItemType:"REGULAR"};if("amount"===n){var m,y=d*a/u*100/100*r;return{productId:s,variantId:l,quantity:d,unitPrice:0!=(m=d*a>=y?d*a-y:0)?m/d:0,lineItemHandle:v,discountType:t,discountValue:"You save {{currency}}".concat(y.toFixed(3)),customLineItemType:"REGULAR"}}return"free"===n?f({productId:s,variantId:l,lineItemHandle:v,quantity:d,getProductCount:c,unitPrice:a,offerCategory:t}):{}},i=function(t){var e=t.offerCategory,n=t.customGetProduct,o=t.lineItems,u=t.getProductCount,c=r(o),i=[];return n.forEach((function(t){if(t){var n=c[t]||{},r=n.productId,o=n.variantId,a=n.quantity,d=n.unitPrice,l=n.lineItemHandle,s=f({productId:r,variantId:o,lineItemHandle:l,quantity:a,getProductCount:u,unitPrice:d,offerCategory:e});i.push(s)}})),i},a=function(t){var e=t.offerCategory,n=t.buyOfferType,r=t.discountType,o=t.discountValue,u=t.getProductCount,i=t.lineItems,a=function(t){var e=t.customBuyCollection,n=t.customGetCollection,r=t.customBuyProduct,o=t.customGetProduct,u=o.length>0?o:r,c=n.length>0?n:e;return u.concat(c)}(t),f="overAll"===n?i:a,d="overAll"===n?function(t){return t.reduce((function(t,e){return t+e.unitPrice*e.quantity}),0)}(f):function(t,e){var n=0;return t.forEach((function(t){if(t){var r=e.reduce((function(e,n){var r=n||{},o=r.collectionId,u=r.variantId,c=r.quantity,i=r.unitPrice;return u!==t&&o!==t||(e+=c*i),e}),0);n+=r}})),n}(f,i),l="percentage"===r&&o>=100?100:o,s=[];return f.forEach((function(t){if(t&&"string"==typeof t)return i.forEach((function(n){var i=n||{},a=i.collectionId;if(i.variantId===t||a===t){var f=c(e,n,r,o,l,d,u);s.push(f)}}));var n=c(e,t,r,o,l,d,u);s.push(n)})),s},f=function(t){var e=t.productId,n=t.variantId,r=t.lineItemHandle,o=t.quantity,u=t.getProductCount,c=t.unitPrice,i=t.offerCategory;return{productId:e,variantId:n,quantity:o,freeQuantity:u,unitPrice:o===u?0:c,lineItemHandle:r,discountType:o>=u?i:"",discountValue:o>=u?"Buy ".concat(o,", get ").concat(u," Free and ").concat(o-u," for the same price."):"Free",customLineItemType:"REGULAR"}},d=function(t){switch(t.offerCategory){case"percentageDiscount":case"flatDiscount":case"volumeDiscount":return function(t){return function(t){var e=t.getRemovedProductList,n=t.buyOfferType,r=t.customGetProduct,u=t.customGetCollection,c="overAll"!==n&&o(t),i="overAll"===n&&function(t){var e=t.cartType,n=t.cartValue;return t.lineItems.reduce((function(t,n){var r=n.quantity,o=n.unitPrice;return t+("amount"===e?r*o:r)}),0)>=n}(t),f=!(r.length>0||u.length>0)||function(t){var e=t.customBuyProduct,n=t.customBuyCollection,r=t.lineItems;return e.concat(n).some((function(t){return r.some((function(e){var n=e||{},r=n.collectionId;return n.variantId===t||r===t}))}))}(t);return{output:(i||c)&&f?a(t):[],getRemovedProductList:e}}(t)}(t);case"buyXGetY":return function(t){var e=function(t){var e=t.getRemovedProductList,n=o(t),r=u(t);return{output:n&&r?i(t):[],getRemovedProductList:e}}(t);return e}(t);case"buyMoreSaveMore":return function(t){var e=function(t){var e=t.getRemovedProductList,n=t.getProductCount,r=o(t),c=0===n||u(t);return{output:r&&c?a(t):[],getRemovedProductList:e}}(t);return e}(t);case"automaticOffers":return function(t){var e=function(t){var e=t.getRemovedProductList;return{output:o(t)?i(t):[],getRemovedProductList:e}}(t);return e}(t);default:return{}}},l=function(t){return t},s=function(t,e){var o=t.cartLineItems,u=(void 0===o?{}:o).lineItems,c=void 0===u?[]:u;if(0===c.length)return JSON.stringify({output:[],getRemovedProductList:[]});var i=function(t){var e=t.buyCollections,n=t.getCollections,r=t.buyProducts,o=t.getProducts,u=t.getProductCount,c=r.map((function(t){return t.variantId}));t.customBuyProduct=c;var i=o.map((function(t){return t.variantId}));t.customGetProduct=i;var a=e.map((function(t){return t.collectionId}));t.customBuyCollection=a;var f=n.map((function(t){return t.collectionId}));return t.customGetCollection=f,u||(t.getProductCount=0),t}(e),a=function(t,e){var o=t.offerCategory,u=t.discountType,c=t.customGetProduct,i=t.customBuyProduct,a=t.customGetCollection,f=t.customBuyCollection,d=function(t,e,n){return t.filter((function(t){var r=t.variantId,o=t.unitPrice,u=t.originalUnitPrice;return t.unitPrice=u,"free"===e?n.find((function(t){return t===r})):o!==u}))}(e,u,c)||[];return e=function(t,e,n,o,u,c){return c=r(c),e.forEach((function(e){var n=c[e]||{},r=n.variantId,o=n.originalUnitPrice;"automaticOffers"===t&&r===e?delete c[e]:r===e&&(c[e].unitPrice=o)})),n.forEach((function(e){var n=c[e]||{},r=n.variantId,o=n.originalUnitPrice;"automaticOffers"===t&&r===e?delete c[e]:r===e&&(c[e].unitPrice=o)})),c=Object.values(c),o.forEach((function(e){c.forEach((function(n){var r=n||{},o=r.collectionId;r.originalUnitPrice,"automaticOffers"===t&&o===e&&delete c[e]}))})),u.forEach((function(e){c.forEach((function(n){var r=n||{},o=r.collectionId;r.originalUnitPrice,"automaticOffers"===t&&o===e&&delete c[e]}))})),c}(o,c,i,a,f,e),n(n({},t),{lineItems:e,getRemovedProductList:d})}(i,c),f=d(a);return JSON.stringify(f)};vajroPlugin=e})();
//# sourceMappingURL=vajroPlugin.js.map