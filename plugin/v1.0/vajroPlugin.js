var vajroPlugin;(()=>{"use strict";var t={d:(e,n)=>{for(var i in n)t.o(n,i)&&!t.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:n[i]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{flow:()=>f,showMessage:()=>s});var n=function(t){var e=t.cartQuantity,n=t.buyProducts,i=t.getProducts,o=t.sanitizedLineItem,r=0;return n.forEach((function(t){var e=t.variantId,n=o[e]?o[e].quantity:0;r+=n})),i.forEach((function(t){var e=t.variantId,n=o[e]?o[e].quantity:0;r+=n})),r>=e},i=function(t){var e=t.offerCategory,n=t.overAll,i=t.getProductValid,o=t.getProductVariantIds,r=t.buyProductVariantIds,u=t.sanitizedLineItem,a=t.discountType,c=t.discountValue,d=c,l=0,s=i?o:r,f=n?Object.values(u):s;return f.forEach((function(t){var e=n?t:u[t],i=e.unitPrice,o=e.quantity;l+=i*o})),f.map((function(t){var i=n?t:u[t],o=i.unitPrice,r=i.quantity,s=i.variantId,f=i.productId,y=i.lineItemHandle;if("percentage"===a)return c>=100&&(d=100),{productId:f,variantId:s,quantity:r,unitPrice:(r*o-r*o*(d/100))/r,lineItemHandle:y,discountType:e,discountValue:"You got ".concat(d,"% off")};if("amount"===a){var v=r*o/l*100/100*c;return{productId:f,variantId:s,quantity:r,unitPrice:(r*o-v)/r,lineItemHandle:y,discountType:e,discountValue:"You save {{currency}}".concat(v.toFixed(3))}}return{}}))},o=function(t){var e=t.cartQuantity,n=(t.offerCategory,t.getCollectionValid),i=t.buyCollections,o=t.getCollections,r=t.sanitizedLineItem,u=[],a=[],c=0,d=0;return n&&o.forEach((function(t){t&&Object.values(r).forEach((function(e){var n=e.collectionId,i=e.variantId,o=e.quantity;n===t&&(d+=o,a.push(i))}))})),i.forEach((function(t){t&&Object.values(r).forEach((function(e){var n=e.collectionId,i=e.variantId,o=e.quantity;n===t&&(c+=o,u.push(i))}))})),(n?c+d:c)>=e?{buyCollectionsIdsValid:u,getCollectionsIdsValid:a}:{}},r=function(t){var e=t.offerCategory,n=t.getCollectionValue,i=t.buyCollectionValue,o=t.sanitizedLineItem,r=t.discountType,u=t.discountValue,a=u,c=0,d=[];if(n){var l=n.buyCollectionsIdsValid,s=n.getCollectionsIdsValid;l&&l.length>0&&s&&s.length>0&&(d=l.concat(s))}else(l=i.buyCollectionsIdsValid)&&l.length>0&&(d=l);return d.forEach((function(t){var e=o[t].unitPrice;c+=e})),d.map((function(t){var n=o[t],i=n.unitPrice,d=n.quantity,l=n.variantId,s=n.productId,f=n.lineItemHandle;if("percentage"===r)return u>=100&&(a=100),{productId:s,variantId:l,quantity:d,unitPrice:(d*i-d*i*(a/100))/d,lineItemHandle:f,discountType:e,discountValue:"You got ".concat(a,"% off")};var y=i/c*100/100*u;return{productId:s,variantId:l,quantity:d,unitPrice:(d*i-y)/d,lineItemHandle:f,discountType:e,discountValue:"You save {{currency}}".concat(y.toFixed(3))}}))},u=function(t){var e=t.cartQuantity,n=t.sanitizedLineItem,i=0;return Object.values(n).forEach((function(t){var e=t.quantity;i+=e})),i>=e},a=function(t){var e=t.cartQuantity,n=t.buyProducts,i=t.sanitizedLineItem,o=0;return n.forEach((function(t){var e=t.variantId,n=i[e]?i[e].quantity:0;o+=n})),o>=e},c=function(t){switch(t.offerCategory){case"percentageDiscount":case"flatDiscount":return function(t){return function(t){var e=t.lineItems,u=t.getRemovedProductList,a=t.offerCategory,c=t.overAll,d=t.getProductValid,l=t.getCollectionValid,s=t.collection,f=t.discountType,y=t.discountValue,v=t.buyCollections,I=t.buyCollectionsCount,g=t.getCollections,m=t.getCollectionsCount,P=t.buyProducts,p=t.getProducts,C=t.cartQuantity,b=P.flatMap((function(t){return t.variantId})),L=p.flatMap((function(t){return t.variantId})),V=e;if(c)return{output:E=i({offerCategory:a,overAll:c,sanitizedLineItem:V,discountType:f,discountValue:y}),getRemovedProductList:u};if(s){if(s){var T=!!l&&o({cartQuantity:C,offerCategory:a,getCollectionValid:l,buyCollections:v,getCollections:g,buyCollectionsCount:I,getCollectionsCount:m,sanitizedLineItem:V}),z=!l&&o({cartQuantity:C,offerCategory:a,buyCollections:v,buyCollectionsCount:I,sanitizedLineItem:V}),h=l?r({offerCategory:a,getCollectionValue:T,sanitizedLineItem:V,discountType:f,discountValue:y}):[],q=l?[]:r({offerCategory:a,buyCollectionValue:z,sanitizedLineItem:V,discountType:f,discountValue:y});return{getRemovedProductList:u,output:l?h:q}}return{getRemovedProductList:u,output:{}}}var Q=!!d&&n({cartQuantity:C,buyProducts:P,getProducts:p,sanitizedLineItem:V}),O=!d&&function(t){var e=t.cartQuantity,n=t.sanitizedLineItem,i=0;return t.buyProducts.forEach((function(t){var e=t.variantId,o=n[e]?n[e].quantity:0;i+=o})),i>=e}({cartQuantity:C,buyProducts:P,sanitizedLineItem:V}),R=d&&Q?i({offerCategory:a,getProductValid:d,getProductVariantIds:L,sanitizedLineItem:V,discountType:f,discountValue:y}):[],E=!d&&O?i({offerCategory:a,getProductValid:d,buyProductVariantIds:b,sanitizedLineItem:V,discountType:f,discountValue:y}):[];return{output:d?R:E,getRemovedProductList:u}}(t)}(t);case"volumeDiscount":return function(t){var e=function(t){var e=t.lineItems,n=t.getRemovedProductList,c=t.overAll,d=t.cartQuantity,l=t.offerCategory,s=t.getCollectionValid,f=t.collection,y=t.discountType,v=t.discountValue,I=t.buyCollections,g=t.buyCollectionsCount,m=t.buyProducts,P=e;if(c)return{getRemovedProductList:n,output:u({cartQuantity:d,sanitizedLineItem:P})?i({offerCategory:l,overAll:c,sanitizedLineItem:P,discountType:y,discountValue:v}):[]};if(f){if(f){var p=!s&&o({cartQuantity:d,offerCategory:l,buyCollections:I,buyCollectionsCount:g,sanitizedLineItem:P});return{getRemovedProductList:n,output:s?[]:r({offerCategory:l,buyCollectionValue:p,sanitizedLineItem:P,discountType:y,discountValue:v})}}return{getRemovedProductList:n,output:{}}}var C=m.flatMap((function(t){return t.variantId}));return{getRemovedProductList:n,output:a({cartQuantity:d,buyProducts:m,sanitizedLineItem:P})?i({offerCategory:l,buyProductVariantIds:C,sanitizedLineItem:P,discountType:y,discountValue:v}):[]}}(t);return e}(t);case"buyXGetY":return function(t){var e=function(t){var e=t.lineItems,i=t.getRemovedProductList,o=t.offerCategory,r=t.cartQuantity,u=t.buyProducts,a=t.getProducts,c=e,d=n({cartQuantity:r,buyProducts:u,getProducts:a,sanitizedLineItem:c})?function(t){var e=t.offerCategory,n=t.sanitizedLineItem;return t.getProducts.map((function(t){var i=t.productId,o=t.variantId;return{productId:i,variantId:o,quantity:n[o].quantity,unitPrice:0,lineItemHandle:n[o].lineItemHandle,discountType:e,discountValue:"Free"}}))}({offerCategory:o,getProducts:a,sanitizedLineItem:c}):[];return{getRemovedProductList:i,output:d}}(t);return e}(t);case"buyMoreSaveMore":return function(t){var e=function(t){var e=t.lineItems,n=t.getRemovedProductList,i=t.offerCategory,o=t.cartTotal,r=t.buyProducts,u=t.getProducts,a=t.discountType,c=t.discountValue,d=e,l=function(t){var e=t.cartTotal,n=t.sanitizedLineItem,i=0;return t.buyProducts.forEach((function(t){var e=t.variantId,o=n[e]?n[e].unitPrice*n[e].quantity:0;i+=o})),i>=e}({cartTotal:o,buyProducts:r,sanitizedLineItem:d}),s=l?function(t){var e=t.offerCategory,n=t.buyProducts,i=t.sanitizedLineItem,o=t.discountType,r=t.discountValue,u=0;return"free"===o?t.getProducts.map((function(t){var n=t.productId,o=t.variantId;return{productId:n,variantId:o,quantity:i[o].quantity,unitPrice:0,lineItemHandle:i[o].lineItemHandle,discountType:e,discountValue:"Free"}})):(n.forEach((function(t){var e=t.variantId,n=i[e],o=n.unitPrice,r=n.quantity;u+=o*r})),n.map((function(t){var n=t.variantId,a=r,c=i[n],d=c.unitPrice,l=c.quantity,s=c.productId,f=c.lineItemHandle;if("percentage"===o)return r>=100&&(a=100),{productId:s,variantId:n,quantity:l,unitPrice:(l*d-l*d*(a/100))/l,lineItemHandle:f,discountType:e,discountValue:"You got ".concat(a,"% off")};if("amount"===o){var y=l*d/u*100/100*r;return{productId:s,variantId:n,quantity:l,unitPrice:(l*d-y)/l,lineItemHandle:f,discountType:e,discountValue:"You save {{currency}}".concat(y.toFixed(3))}}return{}})))}({offerCategory:i,buyProducts:r,getProducts:u,sanitizedLineItem:d,discountType:a,discountValue:c}):[];return{getRemovedProductList:n,output:s}}(t);return e}(t);case"automaticOffers":return function(t){return function(t){var e=t.lineItems,n=t.getRemovedProductList,i=t.offerCategory,r=t.onlyCartAmoutAndQunatity,c=t.collection,d=t.cartTotal,l=t.cartQuantity,s=t.buyProducts,f=t.getProducts,y=t.buyCollections,v=t.buyCollectionsCount,I=e,g=!!r&&function(t){var e=t.cartTotal,n=t.sanitizedLineItem,i=0;return Object.values(n).forEach((function(t){var e=t.unitPrice,n=t.quantity;i+=e*n})),i>=e}({cartTotal:d,sanitizedLineItem:I}),m=!!r&&u({cartQuantity:l,sanitizedLineItem:I}),P=a({buyProducts:s,sanitizedLineItem:I}),p=(c?o({offerCategory:i,buyCollections:y,buyCollectionsCount:v,sanitizedLineItem:I}):{}).buyCollectionsIdsValid;return g||m||P||p?{getRemovedProductList:n,output:f.map((function(t){return{productId:t.productId,variantId:t.variantId,quantity:t.count,unitPrice:0,discountType:i,discountValue:"Free"}}))}:{getRemovedProductList:n,output:{}}}(t)}(t);default:return{}}},d=function(){return d=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},d.apply(this,arguments)},l=function(t){return t.reduce((function(t,e){return t[e.variantId]=e,t}),{})},s=function(t){return t},f=function(t,e){var n=t.cartLineItems,i=(void 0===n?{}:n).lineItems,o=void 0===i?[]:i,r=function(t){var e=t.buyOfferType,n=t.cartType,i=t.cartValue,o=t.getCollections,r=t.getProducts;return t.onlyCartAmoutAndQunatity=!1,t.overAll="overAll"===e,t.collection="collections"===e,"amount"===n?(t.onlyCartAmoutAndQunatity=!0,t.cartTotal=i):t.cartTotal=0,"count"===n?(t.onlyCartAmoutAndQunatity=!0,t.cartQuantity=i):t.cartQuantity=0,o.length>0?t.getCollectionValid=!0:t.getCollectionValid=!1,r.length>0?t.getProductValid=!0:t.getProductValid=!1,t}(e),u=function(t,e){var n=function(t){return t.filter((function(t){var e=t.lineItemType,n=t.originalUnitPrice;return t.unitPrice=n,"READONLY"===e}))}(e)||[];return e=function(t,e,n,i){var o=e.map((function(t){return t.variantId})),r=n.map((function(t){return t.variantId}));return i=l(i),o.forEach((function(e){var n=i[e]||{},o=n.lineItemType,r=n.variantId,u=n.originalUnitPrice;"automaticOffers"===t&&r===e&&"READONLY"===o?delete i[e]:r===e&&"READONLY"===o&&(i[e].unitPrice=u)})),r.forEach((function(e){var n=i[e]||{},o=n.lineItemType,r=n.variantId,u=n.originalUnitPrice;"automaticOffers"===t&&r===e&&"READONLY"===o?delete i[e]:r===e&&"READONLY"===o&&(i[e].unitPrice=u)})),i}(t.offerCategory,t.getProducts,t.buyProducts,e),d(d({},t),{lineItems:e,getRemovedProductList:n})}(r,o),a=c(u);return JSON.stringify(a)};vajroPlugin=e})();
//# sourceMappingURL=vajroPlugin.js.map