var vajroPlugin;(()=>{"use strict";var t={d:(e,n)=>{for(var i in n)t.o(n,i)&&!t.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:n[i]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{flow:()=>m,showMessage:()=>g});var n=function(t){var e=t.overAll,n=t.getProductValid,i=t.getProductVariantIds,u=t.buyProductVariantIds,r=t.sanitizedLineItem,o=t.discountType,a=t.discountValue,c=a,d=n?i:u;return(e?Object.values(r):d).map((function(t){var n=e?t:r[t],i=n.unitPrice,u=n.quantity,d=n.variantId,s=n.productId;return"percentage"===o?(a>=100&&(c=100),{productId:s,variantId:d,quantity:u,unitPrice:(u*i-u*i*(c/100))/u}):{productId:s,variantId:d,quantity:u,unitPrice:(u*(a>=i?a:i)-a)/u}}))},i=function(t){var e=t.offerCategory,n=t.getCollectionValid,i=t.buyCollections,u=t.buyCollectionsCount,r=t.getCollections,o=t.getCollectionsCount,a=t.sanitizedLineItem,c=[],d=[],s=0,l=0;return n&&r.split(",").forEach((function(t){t&&Object.values(a).forEach((function(e){var n=e.collectionId,i=e.variantId,u=e.quantity;n===t&&(l+=u,d.push(i))}))})),i.split(",").forEach((function(t){t&&Object.values(a).forEach((function(e){var n=e.collectionId,i=e.variantId,u=e.quantity;n===t&&(s+=u,c.push(i))}))})),"volumeDiscount"===e?(n?l>=o&&s>=u:s>=u)?{buyCollectionsIdsValid:c,getCollectionsIdsValid:d}:{}:{buyCollectionsIdsValid:c,getCollectionsIdsValid:d}},u=function(t){var e=t.getCollectionValue,n=t.buyCollectionValue,i=t.sanitizedLineItem,u=t.discountType,r=t.discountValue,o=r,a=[];if(e){var c=e.buyCollectionsIdsValid,d=e.getCollectionsIdsValid;c&&c.length>0&&d&&d.length>0&&(a=c.concat(d))}else(c=n.buyCollectionsIdsValid)&&c.length>0&&(a=c);return a.map((function(t){var e=i[t],n=e.unitPrice,a=e.quantity,c=e.variantId,d=e.productId;return"percentage"===u?(r>=100&&(o=100),{productId:d,variantId:c,quantity:a,unitPrice:(a*n-a*n*(o/100))/a}):{productId:d,variantId:c,quantity:a,unitPrice:(a*(r>=n?r:n)-r)/a}}))},r=function(t){var e=t.lineItems,r=t.getRemovedProductList,o=t.offerCategory,a=t.overAll,c=t.getProductValid,d=t.getCollectionValid,s=t.collection,l=t.discountType,v=t.discountValue,y=t.buyCollections,f=t.buyCollectionsCount,I=t.getCollections,g=t.getCollectionsCount,m=t.buyProducts,P=t.getProducts,p=m.flatMap((function(t){return t.variantId})),C=P.flatMap((function(t){return t.variantId})),L=e;if(a)return{output:O=n({overAll:a,sanitizedLineItem:L,discountType:l,discountValue:v}),getRemovedProductList:r};if(s){if(s){var b=!!d&&i({offerCategory:o,getCollectionValid:d,buyCollections:y,getCollections:I,buyCollectionsCount:f,getCollectionsCount:g,sanitizedLineItem:L}),V=!d&&i({offerCategory:o,buyCollections:y,buyCollectionsCount:f,sanitizedLineItem:L}),z=d?u({getCollectionValue:b,sanitizedLineItem:L,discountType:l,discountValue:v}):[],h=d?[]:u({buyCollectionValue:V,sanitizedLineItem:L,discountType:l,discountValue:v});return{getRemovedProductList:r,output:d?z:h}}return{getRemovedProductList:r,output:{}}}var T=!!c&&function(t){var e=t.getProducts,n=t.sanitizedLineItem,i=t.buyProducts.every((function(t){var e=t.variantId,i=t.count;return n[e]&&n[e].quantity>=i})),u=e.every((function(t){var e=t.variantId,i=t.count;return n[e]&&n[e].quantity>=i}));return!(!i||!u)}({buyProducts:m,getProducts:P,sanitizedLineItem:L}),q=!c&&function(t){var e=t.sanitizedLineItem;return!!t.buyProducts.every((function(t){var n=t.variantId,i=t.count;return e[n]&&e[n].quantity>=i}))}({buyProducts:m,sanitizedLineItem:L}),R=c&&T?n({getProductValid:c,getProductVariantIds:C,sanitizedLineItem:L,discountType:l,discountValue:v}):[],O=!c&&q?n({getProductValid:c,buyProductVariantIds:p,sanitizedLineItem:L,discountType:l,discountValue:v}):[];return{output:c?R:O,getRemovedProductList:r}},o=function(t){var e=t.buyProducts,n=t.sanitizedLineItem;return!!e.every((function(t){var e=t.variantId,i=t.count;return!!e&&n[e].quantity>=i}))},a=function(t){var e=t.getProducts,n=t.sanitizedLineItem;return e.map((function(t){var e=t.productId,i=t.variantId,u=t.count,r=n[i].quantity>=u,o=r?0:n[i].unitPrice,a={productId:e,variantId:i,quantity:n[i].quantity,unitPrice:o};return r?a:null}))},c=function(t){var e=t.cartQuantity,n=t.sanitizedLineItem,i=0;return Object.values(n).forEach((function(t){var e=t.quantity;i+=e})),i>=e},d=function(t){var e=t.getProducts,n=t.sanitizedLineItem,i=t.discountType,u=t.discountValue;return e.map((function(t){var e=t.variantId,r=t.amount,o=u,a=n[e].unitPrice*n[e].quantity>=r,c=n[e],d=c.unitPrice,s=c.quantity,l=c.productId;return a?"percentage"===i?(u>=100&&(o=100),{productId:l,variantId:e,quantity:s,unitPrice:(s*d-s*d*(o/100))/s}):{productId:l,variantId:e,quantity:s,unitPrice:(s*(u>=d?u:d)-u)/s}:void 0}))},s=function(){return s=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var u in e=arguments[n])Object.prototype.hasOwnProperty.call(e,u)&&(t[u]=e[u]);return t},s.apply(this,arguments)},l=function(t,e){var n=y(e)||[],i=t.getProducts,u=t.buyProducts;return e=v(i,u,e),s(s({},t),{lineItems:e,getRemovedProductList:n})},v=function(t,e,n){var i=t.map((function(t){return t.variantId})),u=e.map((function(t){return t.variantId}));return n=f(n),i.forEach((function(t){var e=n[t]||{},i=e.lineItemType,u=e.variantId,r=e.originalUnitPrice;u===t&&"READONLY"===i&&(n[t].unitPrice=r)})),u.forEach((function(t){var e=n[t]||{},i=e.lineItemType,u=e.variantId,r=e.originalUnitPrice;u===t&&"READONLY"===i&&(n[t].unitPrice=r)})),n},y=function(t){return t.filter((function(t){var e=t.lineItemType,n=t.originalUnitPrice;return t.unitPrice=n,"READONLY"===e}))},f=function(t){return t.reduce((function(t,e){return t[e.variantId]=e,t}),{})},I=function(t){switch(t.getConfigSchema.offerCategory){case"percentageDiscount":return function(t){var e=t.getConfigSchema,n=t.lineItems,i=l(e,n);return r(i)}(t);case"flatDiscount":return function(t){var e=t.getConfigSchema,n=t.lineItems,i=l(e,n);return r(i)}(t);case"volumeDiscount":return function(t){var e=t.getConfigSchema,r=t.lineItems,a=function(t){var e=t.lineItems,r=t.getRemovedProductList,a=t.overAll,d=t.cartQuantity,s=t.offerCategory,l=t.getCollectionValid,v=t.collection,y=t.discountType,f=t.discountValue,I=t.buyCollections,g=t.buyCollectionsCount,m=t.buyProducts,P=e;if(a)return{getRemovedProductList:r,output:c({cartQuantity:d,sanitizedLineItem:P})?n({overAll:a,sanitizedLineItem:P,discountType:y,discountValue:f}):[]};if(v){if(v){var p=!l&&i({offerCategory:s,buyCollections:I,buyCollectionsCount:g,sanitizedLineItem:P});return{getRemovedProductList:r,output:l?[]:u({buyCollectionValue:p,sanitizedLineItem:P,discountType:y,discountValue:f})}}return{getRemovedProductList:r,output:{}}}var C=m.flatMap((function(t){return t.variantId}));return{getRemovedProductList:r,output:o({buyProducts:m,sanitizedLineItem:P})?n({buyProductVariantIds:C,sanitizedLineItem:P,discountType:y,discountValue:f}):[]}}(l(e,r));return a}(t);case"buyXGetY":return function(t){var e=t.getConfigSchema,n=t.lineItems,i=function(t){var e=t.lineItems,n=t.getRemovedProductList,i=t.onlyCartAmoutAndQunatity,u=t.cartQuantity,r=t.buyProducts,d=t.getProducts,s=e;return i?{getRemovedProductList:n,output:c({cartQuantity:u,sanitizedLineItem:s})?a({getProducts:d,sanitizedLineItem:s}):[]}:{getRemovedProductList:n,output:o({buyProducts:r,sanitizedLineItem:s})?a({getProducts:d,sanitizedLineItem:s}):[]}}(l(e,n));return i}(t);case"buyMoreSaveMore":return function(t){var e=t.getConfigSchema,n=t.lineItems;return function(t){var e=t.lineItems,n=t.getRemovedProductList,i=t.onlyCartAmoutAndQunatity,u=t.cartTotal,r=t.buyProducts,o=t.getProducts,a=t.discountType,c=t.discountValue,s=e;if(i){var l=function(t){var e=t.cartTotal,n=t.sanitizedLineItem,i=0;return Object.values(n).forEach((function(t){var e=t.unitPrice,n=t.quantity;i+=e*n})),i>=e}({cartTotal:u,sanitizedLineItem:s});return{getRemovedProductList:n,output:l?d({getProducts:o,sanitizedLineItem:s,discountType:a,discountValue:c}):[]}}var v=function(t){var e=t.sanitizedLineItem;return!!t.buyProducts.every((function(t){var n=t.variantId,i=t.amount;return!!n&&e[n].unitPrice*e[n].quantity>=i}))}({buyProducts:r,sanitizedLineItem:s});return{getRemovedProductList:n,output:v?d({getProducts:o,sanitizedLineItem:s,discountType:a,discountValue:c}):[]}}(l(e,n))}(t);default:return{}}},g=function(t){return t},m=function(t,e){var n=t.cartLineItems,i=(void 0===n?{}:n).lineItems,u=I({lineItems:void 0===i?[]:i,getConfigSchema:e});return JSON.stringify(u)};vajroPlugin=e})();
//# sourceMappingURL=vajroPlugin.js.map