var vajroPlugin;(()=>{"use strict";var t={d:(e,n)=>{for(var r in n)t.o(n,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:n[r]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{flow:()=>f,showMessage:()=>l});var n=function(){return n=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var u in e=arguments[n])Object.prototype.hasOwnProperty.call(e,u)&&(t[u]=e[u]);return t},n.apply(this,arguments)},r=function(t){var e=t.cartType,n=t.cartValue,r=t.lineItems,u=function(t){var e=t.offerCategory,n=t.customBuyCollection,r=t.customGetCollection,u=t.customBuyProduct,o=t.customGetProduct,c=t.getProductCount,i=u.length>0||n.length>0?u.concat(n):[],a=0===c&&(o.length>0||r.length>0)?o.concat(r):[];return"automaticOffers"!==e?i.concat(a):i}(t);return u.reduce((function(t,n){return t+r.reduce((function(t,r){var u=r||{},o=u.collectionId,c=u.variantId,i=u.quantity,a=u.unitPrice;return c!==n&&o!==n||(t+="amount"===e?i*a:i),t}),0)}),0)>=n},u=function(t){var e=t.customGetProduct,n=t.getProductCount,r=t.lineItems;return e.reduce((function(t,e){return t+r.reduce((function(t,n){var r=n||{},u=r.collectionId,o=r.variantId,c=r.quantity;return o!==e&&u!==e||(t+=c),t}),0)}),0)>=n},o=function(t,e,n,r,u,o,c){var i=e||{},d=i.unitPrice,l=i.quantity,f=i.variantId,s=i.productId,v=i.lineItemHandle;if("percentage"===n)return{productId:s,variantId:f,quantity:l,unitPrice:(m=l*d-l*d*(u/100))/l,lineItemHandle:v,discountType:t,discountValue:"You got ".concat(u,"% off"),customLineItemType:"REGULAR"};if("amount"===n){var m,y=l*d/o*100/100*r;return{productId:s,variantId:f,quantity:l,unitPrice:0!=(m=l*d>=y?l*d-y:0)?m/l:0,lineItemHandle:v,discountType:t,discountValue:"You save {{currency}}".concat(y.toFixed(3)),customLineItemType:"REGULAR"}}return"free"===n?a({productId:s,variantId:f,lineItemHandle:v,quantity:l,getProductCount:c,unitPrice:d,offerCategory:t}):{}},c=function(t){var e=t.offerCategory,n=t.getProducts,r=void 0===n?[]:n,u=t.customGetProduct,o=t.lineItems,c=t.getProductCount,i=function(t){return t.reduce((function(t,e){return t[e.variantId]=e,t}),{})}(o),d=[];return u.forEach((function(t,n){var u,o;if(t){var l=!!i[t],f=i[t]||{},s=f.productId,v=f.variantId,m=f.quantity,y=f.unitPrice,I=f.lineItemHandle,P=a({productId:s,variantId:v,lineItemHandle:I,quantity:m,getProductCount:c,unitPrice:y,offerCategory:e,customGetProductId:null===(u=r[n])||void 0===u?void 0:u.productId,customGetVariantId:null===(o=r[n])||void 0===o?void 0:o.variantId,isGetProductIdInLineitem:l});d.push(P)}})),d},i=function(t){var e=t.offerCategory,n=t.buyOfferType,r=t.discountType,u=t.discountValue,c=t.getProductCount,i=t.lineItems,a=function(t){var e=t.customBuyCollection,n=t.customGetCollection,r=t.customBuyProduct,u=t.customGetProduct,o=u.length>0?u:r,c=n.length>0?n:e;return o.concat(c)}(t),d="overAll"===n?i:a,l="overAll"===n?function(t){return t.reduce((function(t,e){return t+e.unitPrice*e.quantity}),0)}(d):function(t,e){return t.reduce((function(t,n){return t+e.reduce((function(t,e){var r=e||{},u=r.collectionId,o=r.variantId,c=r.quantity,i=r.unitPrice;return o!==n&&u!==n||(t+=c*i),t}),0)}),0)}(d,i),f="percentage"===r&&u>=100?100:u,s=[];return d.forEach((function(t){if(t&&"string"==typeof t)i.forEach((function(n){var i=n||{},a=i.collectionId;if(i.variantId===t||a===t){var d=o(e,n,r,u,f,l,c);s.push(d)}}));else{var n=o(e,t,r,u,f,l,c);s.push(n)}})),s},a=function(t){var e=t.offerCategory,n=t.getProductCount,r=t.customGetProductId,u=t.customGetVariantId,o=t.isGetProductIdInLineitem,c=t.productId,i=t.variantId,a=t.lineItemHandle,d=t.quantity,l=void 0===d?n:d,f=t.unitPrice;return{productId:c||r,variantId:i||u,quantity:l||n,freeQuantity:n,unitPrice:l===n?0:f,lineItemHandle:a,discountType:l>=n?e:"",discountValue:l>=n?"Buy ".concat(l,", Get ").concat(n," Free and ").concat(l-n," For the Same Price."):"",customLineItemType:"REGULAR",isGetProductIdInLineitem:o}},d=function(t){switch(t.offerCategory){case"percentageDiscount":case"flatDiscount":case"volumeDiscount":return function(t){return function(t){var e=t.getRemovedProductList,n=t.buyOfferType,u=t.customGetProduct,o=t.customGetCollection,c="overAll"!==n&&r(t),a="overAll"===n&&function(t){var e=t.cartType,n=t.cartValue;return t.lineItems.reduce((function(t,n){var r=n.quantity,u=n.unitPrice;return t+("amount"===e?r*u:r)}),0)>=n}(t),d=!(u.length>0||o.length>0)||function(t){var e=t.customBuyProduct,n=t.customBuyCollection,r=t.lineItems;return e.concat(n).some((function(t){return r.some((function(e){var n=e||{},r=n.collectionId;return n.variantId===t||r===t}))}))}(t);return{output:(a||c)&&d?i(t):[],getRemovedProductList:e}}(t)}(t);case"buyXGetY":return function(t){var e=function(t){var e=t.getRemovedProductList,n=r(t),o=u(t);return{output:n&&o?c(t):[],getRemovedProductList:e}}(t);return e}(t);case"buyMoreSaveMore":return function(t){var e=function(t){var e=t.getRemovedProductList,n=t.getProductCount,o=r(t),c=0===n||u(t);return{output:o&&c?i(t):[],getRemovedProductList:e}}(t);return e}(t);case"automaticOffers":return function(t){var e=function(t){var e=t.getRemovedProductList;return{output:r(t)?c(t):[],getRemovedProductList:e}}(t);return e}(t);default:return{}}},l=function(t){return t},f=function(t,e){var r=t.cartLineItems,u=(void 0===r?{}:r).lineItems,o=void 0===u?[]:u;if(0===o.length)return JSON.stringify({output:[],getRemovedProductList:[]});var c=function(t){var e=t.buyCollections,n=void 0===e?[]:e,r=t.getCollections,u=void 0===r?[]:r,o=t.buyProducts,c=void 0===o?[]:o,i=t.getProducts,a=void 0===i?[]:i,d=t.getProductCount,l=c.map((function(t){return t.variantId}));t.customBuyProduct=l;var f=a.map((function(t){return t.variantId}));t.customGetProduct=f;var s=n.map((function(t){return t.collectionId}));t.customBuyCollection=s;var v=u.map((function(t){return t.collectionId}));return t.customGetCollection=v,d||(t.getProductCount=0),t}(e),i=function(t,e){var r=function(t,e,n){return t.filter((function(t){var r=t.variantId,u=t.unitPrice,o=t.originalUnitPrice;return t.unitPrice=o,"free"===e?n.find((function(t){return t===r})):u!==o}))}(e,t.discountType,t.customGetProduct)||[],u=function(t){return t.map((function(t){var e=t.originalUnitPrice;return t.unitPrice=e,t}))}(e);return n(n({},t),{lineItems:u,getRemovedProductList:r})}(c,o),a=d(i);return JSON.stringify(a)};vajroPlugin=e})();
//# sourceMappingURL=vajroPlugin.js.map