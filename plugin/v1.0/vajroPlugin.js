var vajroPlugin;(()=>{"use strict";var t={d:(e,n)=>{for(var i in n)t.o(n,i)&&!t.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:n[i]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{flow:()=>v,showMessage:()=>y});var n=function(t){var e=t.offerCategory,n=t.overAll,i=t.getProductValid,o=t.getProductVariantIds,u=t.buyProductVariantIds,r=t.sanitizedLineItem,a=t.discountType,c=t.discountValue,d=c,l=0,s=i?o:u,f=n?Object.values(r):s;return f.forEach((function(t){var e=n?t:r[t],i=e.unitPrice,o=e.quantity;l+=i*o})),f.map((function(t){var i=n?t:r[t],o=i.unitPrice,u=i.quantity,s=i.variantId,f=i.productId,y=i.lineItemHandle;if("percentage"===a)return c>=100&&(d=100),{productId:f,variantId:s,quantity:u,unitPrice:(u*o-u*o*(d/100))/u,lineItemHandle:y,discountType:e,discountValue:"You got ".concat(d,"% off")};var v=u*o/l*100/100*c;return{productId:f,variantId:s,quantity:u,unitPrice:(u*o-v)/u,lineItemHandle:y,discountType:e,discountValue:"You save {{currency}}".concat(v.toFixed(3))}}))},i=function(t){t.offerCategory;var e=t.getCollectionValid,n=t.buyCollections,i=t.buyCollectionsCount,o=t.getCollections,u=t.getCollectionsCount,r=t.sanitizedLineItem,a=[],c=[],d=0,l=0;return e&&o.forEach((function(t){t&&Object.values(r).forEach((function(e){var n=e.collectionId,i=e.variantId,o=e.quantity;n===t&&(l+=o,c.push(i))}))})),n.forEach((function(t){t&&Object.values(r).forEach((function(e){var n=e.collectionId,i=e.variantId,o=e.quantity;n===t&&(d+=o,a.push(i))}))})),(e?l>=u&&d>=i:d>=i)?{buyCollectionsIdsValid:a,getCollectionsIdsValid:c}:{}},o=function(t){var e=t.offerCategory,n=t.getCollectionValue,i=t.buyCollectionValue,o=t.sanitizedLineItem,u=t.discountType,r=t.discountValue,a=r,c=0,d=[];if(n){var l=n.buyCollectionsIdsValid,s=n.getCollectionsIdsValid;l&&l.length>0&&s&&s.length>0&&(d=l.concat(s))}else(l=i.buyCollectionsIdsValid)&&l.length>0&&(d=l);return d.forEach((function(t){var e=o[t].unitPrice;c+=e})),d.map((function(t){var n=o[t],i=n.unitPrice,d=n.quantity,l=n.variantId,s=n.productId,f=n.lineItemHandle;if("percentage"===u)return r>=100&&(a=100),{productId:s,variantId:l,quantity:d,unitPrice:(d*i-d*i*(a/100))/d,lineItemHandle:f,discountType:e,discountValue:"You got ".concat(a,"% off")};var y=i/c*100/100*r;return{productId:s,variantId:l,quantity:d,unitPrice:(d*i-y)/d,lineItemHandle:f,discountType:e,discountValue:"You save {{currency}}".concat(y.toFixed(3))}}))},u=function(t){var e=t.buyProducts,n=t.sanitizedLineItem;return!!e.every((function(t){var e,i=t.variantId,o=t.count;return!!i&&(null===(e=n[i])||void 0===e?void 0:e.quantity)>=o}))},r=function(t){var e=t.offerCategory,n=t.getProducts,i=t.sanitizedLineItem;return n.map((function(t){var n=t.productId,o=t.variantId,u=t.count,r=i[o].quantity>=u,a=r?0:i[o].unitPrice,c={productId:n,variantId:o,quantity:i[o].quantity,unitPrice:a,lineItemHandle:i[o].lineItemHandle,discountType:e,discountValue:"Free"};return r?c:null}))},a=function(t){var e=t.cartQuantity,n=t.sanitizedLineItem,i=0;return Object.values(n).forEach((function(t){var e=t.quantity;i+=e})),i>=e},c=function(t){var e=t.cartTotal,n=t.sanitizedLineItem,i=0;return Object.values(n).forEach((function(t){var e=t.unitPrice,n=t.quantity;i+=e*n})),i>=e},d=function(t){var e=t.offerCategory,n=t.getProducts,i=t.sanitizedLineItem,o=t.discountType,u=t.discountValue,r=0;return n.forEach((function(t){var e=t.variantId,n=i[e],o=n.unitPrice,u=n.quantity;r+=o*u})),n.map((function(t){var n=t.variantId,a=t.amount,c=u,d=i[n].unitPrice*i[n].quantity>=a,l=i[n],s=l.unitPrice,f=l.quantity,y=l.productId,v=l.lineItemHandle;if(d){if("percentage"===o)return u>=100&&(c=100),{productId:y,variantId:n,quantity:f,unitPrice:(f*s-f*s*(c/100))/f,lineItemHandle:v,discountType:e,discountValue:"You got ".concat(c,"% off")};var I=f*s/r*100/100*u;return{productId:y,variantId:n,quantity:f,unitPrice:(f*s-I)/f,lineItemHandle:v,discountType:e,discountValue:"You save {{currency}}".concat(I.toFixed(3))}}}))},l=function(t){switch(t.offerCategory){case"percentageDiscount":case"flatDiscount":return function(t){return function(t){var e=t.lineItems,u=t.getRemovedProductList,r=t.offerCategory,a=t.overAll,c=t.getProductValid,d=t.getCollectionValid,l=t.collection,s=t.discountType,f=t.discountValue,y=t.buyCollections,v=t.buyCollectionsCount,I=t.getCollections,g=t.getCollectionsCount,m=t.buyProducts,P=t.getProducts,p=m.flatMap((function(t){return t.variantId})),C=P.flatMap((function(t){return t.variantId})),L=e;if(a)return{output:O=n({offerCategory:r,overAll:a,sanitizedLineItem:L,discountType:s,discountValue:f}),getRemovedProductList:u};if(l){if(l){var b=!!d&&i({offerCategory:r,getCollectionValid:d,buyCollections:y,getCollections:I,buyCollectionsCount:v,getCollectionsCount:g,sanitizedLineItem:L}),V=!d&&i({offerCategory:r,buyCollections:y,buyCollectionsCount:v,sanitizedLineItem:L}),z=d?o({offerCategory:r,getCollectionValue:b,sanitizedLineItem:L,discountType:s,discountValue:f}):[],T=d?[]:o({offerCategory:r,buyCollectionValue:V,sanitizedLineItem:L,discountType:s,discountValue:f});return{getRemovedProductList:u,output:d?z:T}}return{getRemovedProductList:u,output:{}}}var q=!!c&&function(t){var e=t.getProducts,n=t.sanitizedLineItem,i=t.buyProducts.every((function(t){var e=t.variantId,i=t.count;return n[e]&&n[e].quantity>=i})),o=e.every((function(t){var e=t.variantId,i=t.count;return n[e]&&n[e].quantity>=i}));return!(!i||!o)}({buyProducts:m,getProducts:P,sanitizedLineItem:L}),R=!c&&function(t){var e=t.sanitizedLineItem;return!!t.buyProducts.every((function(t){var n=t.variantId,i=t.count;return e[n]&&e[n].quantity>=i}))}({buyProducts:m,sanitizedLineItem:L}),h=c&&q?n({offerCategory:r,getProductValid:c,getProductVariantIds:C,sanitizedLineItem:L,discountType:s,discountValue:f}):[],O=!c&&R?n({offerCategory:r,getProductValid:c,buyProductVariantIds:p,sanitizedLineItem:L,discountType:s,discountValue:f}):[];return{output:c?h:O,getRemovedProductList:u}}(t)}(t);case"volumeDiscount":return function(t){var e=function(t){var e=t.lineItems,r=t.getRemovedProductList,c=t.overAll,d=t.cartQuantity,l=t.offerCategory,s=t.getCollectionValid,f=t.collection,y=t.discountType,v=t.discountValue,I=t.buyCollections,g=t.buyCollectionsCount,m=t.buyProducts,P=e;if(c)return{getRemovedProductList:r,output:a({cartQuantity:d,sanitizedLineItem:P})?n({offerCategory:l,overAll:c,sanitizedLineItem:P,discountType:y,discountValue:v}):[]};if(f){if(f){var p=!s&&i({offerCategory:l,buyCollections:I,buyCollectionsCount:g,sanitizedLineItem:P});return{getRemovedProductList:r,output:s?[]:o({offerCategory:l,buyCollectionValue:p,sanitizedLineItem:P,discountType:y,discountValue:v})}}return{getRemovedProductList:r,output:{}}}var C=m.flatMap((function(t){return t.variantId}));return{getRemovedProductList:r,output:u({buyProducts:m,sanitizedLineItem:P})?n({offerCategory:l,buyProductVariantIds:C,sanitizedLineItem:P,discountType:y,discountValue:v}):[]}}(t);return e}(t);case"buyXGetY":return function(t){var e=function(t){var e=t.lineItems,n=t.getRemovedProductList,i=t.offerCategory,o=t.onlyCartAmoutAndQunatity,c=t.cartQuantity,d=t.buyProducts,l=t.getProducts,s=e;return o?{getRemovedProductList:n,output:a({cartQuantity:c,sanitizedLineItem:s})?r({offerCategory:i,getProducts:l,sanitizedLineItem:s}):[]}:{getRemovedProductList:n,output:u({buyProducts:d,sanitizedLineItem:s})?r({offerCategory:i,getProducts:l,sanitizedLineItem:s}):[]}}(t);return e}(t);case"buyMoreSaveMore":return function(t){var e=function(t){var e=t.lineItems,n=t.getRemovedProductList,i=t.offerCategory,o=t.onlyCartAmoutAndQunatity,u=t.cartTotal,r=t.buyProducts,a=t.getProducts,l=t.discountType,s=t.discountValue,f=e;if(o)return{getRemovedProductList:n,output:c({cartTotal:u,sanitizedLineItem:f})?d({offerCategory:i,getProducts:a,sanitizedLineItem:f,discountType:l,discountValue:s}):[]};var y=function(t){var e=t.sanitizedLineItem;return!!t.buyProducts.every((function(t){var n=t.variantId,i=t.amount;return!!n&&e[n].unitPrice*e[n].quantity>=i}))}({buyProducts:r,sanitizedLineItem:f});return{getRemovedProductList:n,output:y?d({offerCategory:i,getProducts:a,sanitizedLineItem:f,discountType:l,discountValue:s}):[]}}(t);return e}(t);case"automaticOffers":return function(t){var e=function(t){var e=t.lineItems,n=t.getRemovedProductList,o=t.offerCategory,r=t.onlyCartAmoutAndQunatity,d=t.collection,l=t.cartTotal,s=t.cartQuantity,f=t.buyProducts,y=t.getProducts,v=t.buyCollections,I=t.buyCollectionsCount,g=e,m=!!r&&c({cartTotal:l,sanitizedLineItem:g}),P=!!r&&a({cartQuantity:s,sanitizedLineItem:g}),p=u({buyProducts:f,sanitizedLineItem:g}),C=(d?i({offerCategory:o,buyCollections:v,buyCollectionsCount:I,sanitizedLineItem:g}):{}).buyCollectionsIdsValid;return m||P||p||C?{getRemovedProductList:n,output:y.map((function(t){return{productId:t.productId,variantId:t.variantId,quantity:t.count,unitPrice:0,discountType:o,discountValue:"Free"}}))}:{getRemovedProductList:n,output:{}}}(t);return e}(t);default:return{}}},s=function(){return s=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},s.apply(this,arguments)},f=function(t){return t.reduce((function(t,e){return t[e.variantId]=e,t}),{})},y=function(t){return t},v=function(t,e){var n=t.cartLineItems,i=(void 0===n?{}:n).lineItems,o=void 0===i?[]:i,u=function(t){var e=t.getCollections,n=t.getProducts;return e.length>0?t.getCollectionValid=!0:t.getCollectionValid=!1,n.length>0?t.getProductValid=!0:t.getProductValid=!1,t}(e),r=function(t,e){var n=function(t){return t.filter((function(t){var e=t.lineItemType,n=t.originalUnitPrice;return t.unitPrice=n,"READONLY"===e}))}(e)||[];return e=function(t,e,n,i){var o=e.map((function(t){return t.variantId})),u=n.map((function(t){return t.variantId}));return i=f(i),o.forEach((function(e){var n=i[e]||{},o=n.lineItemType,u=n.variantId,r=n.originalUnitPrice;"automaticOffers"===t&&u===e&&"READONLY"===o?delete i[e]:u===e&&"READONLY"===o&&(i[e].unitPrice=r)})),u.forEach((function(e){var n=i[e]||{},o=n.lineItemType,u=n.variantId,r=n.originalUnitPrice;"automaticOffers"===t&&u===e&&"READONLY"===o?delete i[e]:u===e&&"READONLY"===o&&(i[e].unitPrice=r)})),i}(t.offerCategory,t.getProducts,t.buyProducts,e),s(s({},t),{lineItems:e,getRemovedProductList:n})}(u,o),a=l(r);return JSON.stringify(a)};vajroPlugin=e})();
//# sourceMappingURL=vajroPlugin.js.map