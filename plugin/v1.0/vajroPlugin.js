var vajroPlugin;(()=>{"use strict";var t={d:(e,n)=>{for(var r in n)t.o(n,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:n[r]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{flow:()=>s});var n=function(){return n=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var u in e=arguments[n])Object.prototype.hasOwnProperty.call(e,u)&&(t[u]=e[u]);return t},n.apply(this,arguments)},r=function(t){return t.reduce((function(t,e){return t[e.variantId]=e,t}),{})},u=function(t,e){var n=r(e);return t.reduce((function(t,e){var r=e.variantId,u=e.unitPrice,o=e.quantity,i=n[r]||{},c=i.unitPrice;return t+(c||0===c?c:u)*(i.quantity||o)}),0)},o=function(t){var e=t.cartType,n=t.cartValue,r=t.lineItems,u=function(t){var e=t.offerCategory,n=t.customBuyCollection,r=t.customGetCollection,u=t.customBuyProduct,o=t.customGetProduct,i=t.getProductCount,c=u.length>0||n.length>0?u.concat(n):[],a=0===i&&(o.length>0||r.length>0)?o.concat(r):[];return"automaticOffers"!==e?c.concat(a):c}(t);return u.reduce((function(t,n){return t+r.reduce((function(t,r){var u=r||{},o=u.collectionId,i=u.variantId,c=u.quantity,a=u.unitPrice;return i!==n&&o!==n||(t+="amount"===e?c*a:c),t}),0)}),0)>=n},i=function(t){var e=t.cartType,n=t.cartValue;return t.lineItems.reduce((function(t,n){var r=n.quantity,u=n.unitPrice;return t+("amount"===e?r*u:r)}),0)>=n},c=function(t){var e=t.customGetProduct,n=t.customGetCollection,r=t.lineItems;return e.concat(n).some((function(t){return r.some((function(e){var n=e||{},r=n.collectionId;return n.variantId===t||r===t}))}))},a=function(t,e,n,r,u,o){var i=e||{},c=i.unitPrice,a=i.quantity,l=i.variantId,d=i.productId,f=i.lineItemHandle;if("percentage"===n)return{productId:d,variantId:l,quantity:a,unitPrice:(s=a*c-a*c*(u/100))/a,lineItemHandle:f,discountType:t,discountValue:"You got ".concat(u,"% off"),customLineItemType:"REGULAR"};if("amount"===n){var s,v=a*c/o*100/100*r;return{productId:d,variantId:l,quantity:a,unitPrice:0!=(s=a*c>=v?a*c-v:0)?s/a:0,lineItemHandle:f,discountType:t,discountValue:"You save {{currency}}".concat(v.toFixed(3)),customLineItemType:"REGULAR"}}return{}},l=function(t){var e=t.offerCategory,n=t.getProducts,u=t.customGetProduct,o=t.lineItems,i=t.getProductCount,c=r(o),a=u.filter((function(t){return c[t]})).sort((function(t,e){return c[t].unitPrice-c[e].unitPrice})),l=[],f=i;return a.forEach((function(t,r){var u,o;if(f){var i=!!c[t],a=c[t]||{},s=a.productId,v=a.variantId,m=a.quantity,g=a.unitPrice,y=a.lineItemHandle,I=f>m?m:f;(f-=m)<0&&(f=0);var P=d({productId:s,variantId:v,lineItemHandle:y,quantity:m,getProductCount:I,unitPrice:g,offerCategory:e,customGetProductId:null===(u=n[r])||void 0===u?void 0:u.productId,customGetVariantId:null===(o=n[r])||void 0===o?void 0:o.variantId,isGetProductIdInLineitem:i});l.push(P)}})),l},d=function(t){var e=t.offerCategory,n=t.getProductCount,r=t.customGetProductId,u=t.customGetVariantId,o=t.isGetProductIdInLineitem,i=t.productId,c=t.variantId,a=t.lineItemHandle,l=t.quantity,d=void 0===l?n:l,f=t.unitPrice,s=o&&n>d?n:d;return{productId:i||r,variantId:c||u,quantity:s,freeQuantity:n,unitPrice:s===n?0:f,lineItemHandle:a,discountType:s>=n?e:"",discountValue:s>=n?"Buy ".concat(s,", Get ").concat(n," Free and ").concat(s-n," For the Same Price."):"",customLineItemType:"REGULAR",isGetProductIdInLineitem:o}},f=function(t){switch(t.offerCategory){case"percentageDiscount":case"flatDiscount":return function(t){var e=t.getRemovedProductList,n=t.lineItems,r=t.buyOfferType,l=t.customGetProduct,d=t.customGetCollection,f=t.displayText,s=void 0===f?"":f,v=t.getConfigSchema,m="overAll"!==r&&o(t),g="overAll"===r||!(l.length>0||d.length>0)||function(t){var e=t.customBuyProduct,n=t.customBuyCollection,r=t.lineItems;return e.concat(n).some((function(t){return r.some((function(e){var n=e||{},r=n.collectionId;return n.variantId===t||r===t}))}))}(t),y="overAll"===r||!(l.length>0||d.length>0)||c(t),I="overAll"!==r||!(l.length>0||d.length>0)||c(t),P=("overAll"===r&&I&&i(t)||m)&&g&&y?function(t){var e=t.offerCategory,n=t.buyOfferType,r=t.discountType,u=t.discountValue,o=t.lineItems,i=t.customGetProduct,c=t.customGetCollection,l=function(t){var e=t.customBuyCollection,n=t.customGetCollection,r=t.customBuyProduct,u=t.customGetProduct,o=u.length>0?u:r,i=n.length>0?n:e,c=r.length>0&&n.length>0?n:[],a=u.length>0&&e.length>0?u:[];return c.length>0||a.length>0?c.concat(a):o.concat(i)}(t),d="overAll"===n&&i.length<=0&&c.length<=0?o:l,f="overAll"===n?function(t){return t.reduce((function(t,e){return t+e.unitPrice*e.quantity}),0)}(d):function(t){var e=t.lineItems;return t.sanitizedLineItem.reduce((function(t,n){return t+e.reduce((function(t,e){var r=e||{},u=r.collectionId,o=r.variantId,i=r.quantity,c=r.unitPrice;return o!==n&&u!==n||(t+=i*c),t}),0)}),0)}({sanitizedLineItem:d,lineItems:o}),s="percentage"===r&&u>=100?100:u,v=[];return d.forEach((function(t){"string"==typeof t&&o.forEach((function(n){var o=n||{},i=o.collectionId;if(o.variantId===t||i===t){var c=a(e,n,r,u,s,f);v.push(c)}}));var n=a(e,t,r,u,s,f);v.push(n)})),v}(t):[];return{output:P,getRemovedProductList:e,displayText:P.length>0&&s.length>0?s:"",totalCartValue:u(n,P),schema:v}}(t);case"buyXGetY":return function(t){var e=t.getRemovedProductList,n=t.getConfigSchema,r=t.lineItems,c=t.buyOfferType,a=t.displayText,d="overAll"!==c?o(t):i(t),f=function(t){var e=t.customGetProduct,n=t.getProductCount,r=t.lineItems;return e.reduce((function(t,e){return t+r.reduce((function(t,n){var r=n||{},u=r.collectionId,o=r.variantId,i=r.quantity;return o!==e&&u!==e||(t+=i),t}),0)}),0)>=n}(t),s=d&&f?l(t):[];return{output:s,getRemovedProductList:e,displayText:s.length>0&&a.length>0?a:"",totalCartValue:u(r,s),schema:n}}(t);case"automaticOffers":return function(t){var e=t.getRemovedProductList,n=t.getConfigSchema,r=t.lineItems,c=t.buyOfferType,a=t.displayText,d=("overAll"!==c?o(t):i(t))?l(t):[];return{output:d,getRemovedProductList:e,displayText:d.length>0&&a.length>0?a:"",totalCartValue:u(r,d),schema:n}}(t);default:return{}}},s=function(t,e){var r=t.cartLineItems.lineItems,u=e.map((function(t){var e=function(t){var e=t.buyCollections,n=void 0===e?[]:e,r=t.getCollections,u=void 0===r?[]:r,o=t.buyProducts,i=void 0===o?[]:o,c=t.getProducts,a=void 0===c?[]:c,l=t.getProductCount,d=i.map((function(t){return t.variantId}));t.customBuyProduct=d;var f=a.map((function(t){return t.variantId}));t.customGetProduct=f;var s=n.map((function(t){return t.collectionId}));t.customBuyCollection=s;var v=u.map((function(t){return t.collectionId}));return t.customGetCollection=v,l||(t.getProductCount=0),t}(t),u=function(t,e){var r=function(t,e,n){return t.filter((function(t){var r=t.variantId,u=t.unitPrice,o=t.originalUnitPrice;return t.unitPrice=o,"free"===e?n.find((function(t){return t===r})):u!==o}))}(e,t.discountType,t.customGetProduct)||[],u=function(t){return t.map((function(t){var e=t.originalUnitPrice;return t.unitPrice=e,t}))}(e);return n(n({getConfigSchema:t},t),{lineItems:u,getRemovedProductList:r})}(e,r);return f(u)})),o=u.sort((function(t,e){return t.totalCartValue-e.totalCartValue}));return JSON.stringify(o[0])};vajroPlugin=e})();
//# sourceMappingURL=vajroPlugin.js.map