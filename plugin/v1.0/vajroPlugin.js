var vajroPlugin;(()=>{"use strict";var t={d:(e,n)=>{for(var i in n)t.o(n,i)&&!t.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:n[i]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{flow:()=>s,showMessage:()=>l});var n=function(t){var e=t.cartQuantity,n=t.sanitizedLineItem,i=0;return Object.values(n).forEach((function(t){var e=t.quantity;i+=e})),i>=e},i=function(t){var e=t.offerCategory,n=t.overAll,i=t.getProductValid,r=t.getProductVariantIds,u=t.buyProductVariantIds,o=t.sanitizedLineItem,a=t.discountType,c=t.discountValue,d=c,l=0,s=i?r:u,y=n?Object.values(o):s;return y.forEach((function(t){var e=n?t:o[t],i=e.unitPrice,r=e.quantity;l+=i*r})),y.map((function(t){var i=n?t:o[t],r=i.unitPrice,u=i.quantity,s=i.variantId,y=i.productId,f=i.lineItemHandle;if("percentage"===a)return c>=100&&(d=100),{productId:y,variantId:s,quantity:u,unitPrice:(u*r-u*r*(d/100))/u,lineItemHandle:f,discountType:e,discountValue:"You got ".concat(d,"% off")};if("amount"===a){var v=u*r/l*100/100*c;return{productId:y,variantId:s,quantity:u,unitPrice:(u*r-v)/u,lineItemHandle:f,discountType:e,discountValue:"You save {{currency}}".concat(v.toFixed(3))}}return{}}))},r=function(t){var e=t.cartQuantity,n=(t.offerCategory,t.getCollectionValid),i=t.buyCollections,r=t.getCollections,u=t.sanitizedLineItem,o=[],a=[],c=0,d=0;return n&&r.forEach((function(t){t&&Object.values(u).forEach((function(e){var n=e.collectionId,i=e.variantId,r=e.quantity;n===t&&(d+=r,a.push(i))}))})),i.forEach((function(t){t&&Object.values(u).forEach((function(e){var n=e.collectionId,i=e.variantId,r=e.quantity;n===t&&(c+=r,o.push(i))}))})),(n?c+d:c)>=e?{buyCollectionsIdsValid:o,getCollectionsIdsValid:a}:{}},u=function(t){var e=t.offerCategory,n=t.getCollectionValue,i=t.buyCollectionValue,r=t.sanitizedLineItem,u=t.discountType,o=t.discountValue,a=o,c=0,d=[];if(n){var l=n.buyCollectionsIdsValid,s=n.getCollectionsIdsValid;l&&l.length>0&&s&&s.length>0&&(d=l.concat(s))}else(l=i.buyCollectionsIdsValid)&&l.length>0&&(d=l);return d.forEach((function(t){var e=r[t].unitPrice;c+=e})),d.map((function(t){var n=r[t],i=n.unitPrice,d=n.quantity,l=n.variantId,s=n.productId,y=n.lineItemHandle;if("percentage"===u)return o>=100&&(a=100),{productId:s,variantId:l,quantity:d,unitPrice:(d*i-d*i*(a/100))/d,lineItemHandle:y,discountType:e,discountValue:"You got ".concat(a,"% off")};var f=i/c*100/100*o;return{productId:s,variantId:l,quantity:d,unitPrice:(d*i-f)/d,lineItemHandle:y,discountType:e,discountValue:"You save {{currency}}".concat(f.toFixed(3))}}))},o=function(t){var e=t.cartQuantity,n=t.buyProducts,i=t.sanitizedLineItem,r=0;return n.forEach((function(t){var e=t.variantId,n=i[e]?i[e].quantity:0;r+=n})),r>=e},a=function(t){switch(t.offerCategory){case"percentageDiscount":case"flatDiscount":return function(t){return function(t){var e=t.lineItems,n=t.getRemovedProductList,o=t.offerCategory,a=t.overAll,c=t.getProductValid,d=t.getCollectionValid,l=t.collection,s=t.discountType,y=t.discountValue,f=t.buyCollections,v=t.buyCollectionsCount,I=t.getCollections,g=t.getCollectionsCount,m=t.buyProducts,P=t.getProducts,p=t.cartQuantity,C=m.flatMap((function(t){return t.variantId})),b=P.flatMap((function(t){return t.variantId})),L=e;if(a)return{output:R=i({offerCategory:o,overAll:a,sanitizedLineItem:L,discountType:s,discountValue:y}),getRemovedProductList:n};if(l){if(l){var V=!!d&&r({cartQuantity:p,offerCategory:o,getCollectionValid:d,buyCollections:f,getCollections:I,buyCollectionsCount:v,getCollectionsCount:g,sanitizedLineItem:L}),T=!d&&r({cartQuantity:p,offerCategory:o,buyCollections:f,buyCollectionsCount:v,sanitizedLineItem:L}),z=d?u({offerCategory:o,getCollectionValue:V,sanitizedLineItem:L,discountType:s,discountValue:y}):[],q=d?[]:u({offerCategory:o,buyCollectionValue:T,sanitizedLineItem:L,discountType:s,discountValue:y});return{getRemovedProductList:n,output:d?z:q}}return{getRemovedProductList:n,output:{}}}var h=!!c&&function(t){var e=t.cartQuantity,n=t.getProducts,i=t.sanitizedLineItem,r=0,u=t.buyProducts.every((function(t){var e=t.variantId,n=i[e]?i[e].quantity:0;return r+=n,!!i[e]})),o=n.every((function(t){var e=t.variantId,n=i[e]?i[e].quantity:0;return r+=n,!!i[e]}));return!!(r>=e&&u&&o)}({cartQuantity:p,buyProducts:m,getProducts:P,sanitizedLineItem:L}),Q=!c&&function(t){var e=t.cartQuantity,n=t.sanitizedLineItem,i=0,r=t.buyProducts.every((function(t){var e=t.variantId,r=n[e]?n[e].quantity:0;return i+=r,!!n[e]}));return!!(i>=e&&r)}({cartQuantity:p,buyProducts:m,sanitizedLineItem:L}),O=c&&h?i({offerCategory:o,getProductValid:c,getProductVariantIds:b,sanitizedLineItem:L,discountType:s,discountValue:y}):[],R=!c&&Q?i({offerCategory:o,getProductValid:c,buyProductVariantIds:C,sanitizedLineItem:L,discountType:s,discountValue:y}):[];return{output:c?O:R,getRemovedProductList:n}}(t)}(t);case"volumeDiscount":return function(t){var e=function(t){var e=t.lineItems,a=t.getRemovedProductList,c=t.overAll,d=t.cartQuantity,l=t.offerCategory,s=t.getCollectionValid,y=t.collection,f=t.discountType,v=t.discountValue,I=t.buyCollections,g=t.buyCollectionsCount,m=t.buyProducts,P=e;if(c)return{getRemovedProductList:a,output:n({cartQuantity:d,sanitizedLineItem:P})?i({offerCategory:l,overAll:c,sanitizedLineItem:P,discountType:f,discountValue:v}):[]};if(y){if(y){var p=!s&&r({cartQuantity:d,offerCategory:l,buyCollections:I,buyCollectionsCount:g,sanitizedLineItem:P});return{getRemovedProductList:a,output:s?[]:u({offerCategory:l,buyCollectionValue:p,sanitizedLineItem:P,discountType:f,discountValue:v})}}return{getRemovedProductList:a,output:{}}}var C=m.flatMap((function(t){return t.variantId}));return{getRemovedProductList:a,output:o({cartQuantity:d,buyProducts:m,sanitizedLineItem:P})?i({offerCategory:l,buyProductVariantIds:C,sanitizedLineItem:P,discountType:f,discountValue:v}):[]}}(t);return e}(t);case"buyXGetY":return function(t){var e=function(t){var e=t.lineItems,n=t.getRemovedProductList,i=t.offerCategory,r=t.cartQuantity,u=t.buyProducts,o=t.getProducts,a=e,c=function(t){var e=t.cartQuantity,n=t.getProducts,i=t.getProductCount,r=t.sanitizedLineItem,u=0,o=t.buyProducts.every((function(t){var e=t.variantId,n=r[e]?r[e].quantity:0;return u+=n,!!r[e]})),a=0,c=n.every((function(t){var e=t.variantId,n=r[e]?r[e].quantity:0;return a+=n,!!r[e]}));return!!(u>=e&&a>=i&&o&&c)}({cartQuantity:r,buyProducts:u,getProducts:o,getProductCount:t.getProductCount,sanitizedLineItem:a}),d=c?function(t){var e=t.offerCategory,n=t.sanitizedLineItem;return t.getProducts.map((function(t){var i=t.productId,r=t.variantId;return{productId:i,variantId:r,quantity:n[r].quantity,unitPrice:0,lineItemHandle:n[r].lineItemHandle,discountType:e,discountValue:"Free"}}))}({offerCategory:i,getProducts:o,sanitizedLineItem:a}):[];return{getRemovedProductList:n,output:d}}(t);return e}(t);case"buyMoreSaveMore":return function(t){var e=function(t){var e=t.lineItems,n=t.getRemovedProductList,i=t.offerCategory,r=t.cartTotal,u=t.buyProducts,o=t.getProducts,a=t.getProductCount,c=t.discountType,d=t.discountValue,l=e,s=function(t){var e=t.discountType,n=t.cartTotal,i=t.getProducts,r=t.getProductCount,u=t.sanitizedLineItem,o=0,a=0;return t.buyProducts.forEach((function(t){var e=t.variantId,n=u[e]?u[e].unitPrice*u[e].quantity:0;o+=n})),"free"===e&&i.forEach((function(t){var e=t.variantId,n=u[e]?u[e].quantity:0;a+=n})),"free"===e&&o>=n&&a>=r||"free"!==e&&o>=n}({discountType:c,cartTotal:r,buyProducts:u,getProducts:o,getProductCount:a,sanitizedLineItem:l}),y=s?function(t){var e=t.offerCategory,n=t.buyProducts,i=t.sanitizedLineItem,r=t.discountType,u=t.discountValue,o=0;return"free"===r?t.getProducts.map((function(t){var n=t.productId,r=t.variantId;return{productId:n,variantId:r,quantity:i[r].quantity,unitPrice:0,lineItemHandle:i[r].lineItemHandle,discountType:e,discountValue:"Free"}})):(n.forEach((function(t){var e=t.variantId,n=i[e],r=n.unitPrice,u=n.quantity;o+=r*u})),n.map((function(t){var n=t.variantId,a=u,c=i[n],d=c.unitPrice,l=c.quantity,s=c.productId,y=c.lineItemHandle;if("percentage"===r)return u>=100&&(a=100),{productId:s,variantId:n,quantity:l,unitPrice:(l*d-l*d*(a/100))/l,lineItemHandle:y,discountType:e,discountValue:"You got ".concat(a,"% off")};if("amount"===r){var f=l*d/o*100/100*u;return{productId:s,variantId:n,quantity:l,unitPrice:(l*d-f)/l,lineItemHandle:y,discountType:e,discountValue:"You save {{currency}}".concat(f.toFixed(3))}}return{}})))}({offerCategory:i,buyProducts:u,getProducts:o,sanitizedLineItem:l,discountType:c,discountValue:d}):[];return{getRemovedProductList:n,output:y}}(t);return e}(t);case"automaticOffers":return function(t){return function(t){var e=t.lineItems,i=t.getRemovedProductList,u=t.offerCategory,a=t.onlyCartAmoutAndQunatity,c=t.collection,d=t.cartTotal,l=t.cartQuantity,s=t.buyProducts,y=t.getProducts,f=t.buyCollections,v=t.buyCollectionsCount,I=e,g=!!a&&function(t){var e=t.cartTotal,n=t.sanitizedLineItem,i=0;return Object.values(n).forEach((function(t){var e=t.unitPrice,n=t.quantity;i+=e*n})),i>=e}({cartTotal:d,sanitizedLineItem:I}),m=!!a&&n({cartQuantity:l,sanitizedLineItem:I}),P=o({buyProducts:s,sanitizedLineItem:I}),p=(c?r({offerCategory:u,buyCollections:f,buyCollectionsCount:v,sanitizedLineItem:I}):{}).buyCollectionsIdsValid;return g||m||P||p?{getRemovedProductList:i,output:y.map((function(t){return{productId:t.productId,variantId:t.variantId,quantity:t.count,unitPrice:0,discountType:u,discountValue:"Free"}}))}:{getRemovedProductList:i,output:{}}}(t)}(t);default:return{}}},c=function(){return c=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},c.apply(this,arguments)},d=function(t){return t.reduce((function(t,e){return t[e.variantId]=e,t}),{})},l=function(t){return t},s=function(t,e){var n=t.cartLineItems,i=(void 0===n?{}:n).lineItems,r=void 0===i?[]:i,u=function(t){var e=t.buyOfferType,n=t.cartType,i=t.cartValue,r=t.getCollections,u=t.getProducts;return t.onlyCartAmoutAndQunatity=!1,t.overAll="overAll"===e,t.collection="collections"===e,"amount"===n?(t.onlyCartAmoutAndQunatity=!0,t.cartTotal=i):t.cartTotal=0,"count"===n?(t.onlyCartAmoutAndQunatity=!0,t.cartQuantity=i):t.cartQuantity=0,r.length>0?t.getCollectionValid=!0:t.getCollectionValid=!1,u.length>0?t.getProductValid=!0:t.getProductValid=!1,t}(e),o=function(t,e){var n=function(t){return t.filter((function(t){var e=t.lineItemType,n=t.originalUnitPrice;return t.unitPrice=n,"READONLY"===e}))}(e)||[];return e=function(t,e,n,i){var r=e.map((function(t){return t.variantId})),u=n.map((function(t){return t.variantId}));return i=d(i),r.forEach((function(e){var n=i[e]||{},r=n.lineItemType,u=n.variantId,o=n.originalUnitPrice;"automaticOffers"===t&&u===e&&"READONLY"===r?delete i[e]:u===e&&"READONLY"===r&&(i[e].unitPrice=o)})),u.forEach((function(e){var n=i[e]||{},r=n.lineItemType,u=n.variantId,o=n.originalUnitPrice;"automaticOffers"===t&&u===e&&"READONLY"===r?delete i[e]:u===e&&"READONLY"===r&&(i[e].unitPrice=o)})),i}(t.offerCategory,t.getProducts,t.buyProducts,e),c(c({},t),{lineItems:e,getRemovedProductList:n})}(u,r),l=a(o);return JSON.stringify(l)};vajroPlugin=e})();
//# sourceMappingURL=vajroPlugin.js.map