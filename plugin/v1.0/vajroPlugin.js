var vajroPlugin;(()=>{"use strict";var t={d:(e,r)=>{for(var n in r)t.o(r,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:r[n]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{flow:()=>l,showMessage:()=>f});var r=function(){return r=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var u in e=arguments[r])Object.prototype.hasOwnProperty.call(e,u)&&(t[u]=e[u]);return t},r.apply(this,arguments)},n=function(t){return t.reduce((function(t,e){return t[e.variantId]=e,t}),{})},u=function(t){var e=t.cartType,r=t.cartValue,n=t.lineItems,u=function(t){var e=t.offerCategory,r=t.customBuyCollection,n=t.customGetCollection,u=t.customBuyProduct,o=t.customGetProduct,c=t.getProductCount,i=u.length>0||r.length>0?u.concat(r):[],a=0===c&&(o.length>0||n.length>0)?o.concat(n):[];return"automaticOffers"!==e?i.concat(a):i}(t);return u.every((function(t){return!!t&&n.reduce((function(r,n){var u=n||{},o=u.collectionId,c=u.variantId,i=u.quantity,a=u.unitPrice;return c!==t&&o!==t||(r+="amount"===e?i*a:i),r}),0)>=r}))},o=function(t){var e=t.customGetProduct,r=t.getProductCount,n=t.lineItems;return e.every((function(t){return!!t&&n.reduce((function(e,r){var n=r||{},u=n.collectionId,o=n.variantId,c=n.quantity;return o!==t&&u!==t||(e+=c),e}),0)>=r}))},c=function(t,e,r,n,u,o){var c=e||{},i=c.unitPrice,a=c.quantity,d=c.variantId,f=c.productId,l=c.lineItemHandle;if("percentage"===r)return{productId:f,variantId:d,quantity:a,unitPrice:(a*i-a*i*(u/100))/a,lineItemHandle:l,discountType:t,discountValue:"You got ".concat(u,"% off")};if("amount"===r){var v=a*i/o*100/100*n;return{productId:f,variantId:d,quantity:a,unitPrice:(a*i-v)/a,lineItemHandle:l,discountType:t,discountValue:"You save {{currency}}".concat(v.toFixed(3))}}return"free"===r?{productId:f,variantId:d,quantity:a,unitPrice:0,lineItemHandle:l,discountType:t,discountValue:"Free"}:{}},i=function(t){var e=t.offerCategory,r=t.customGetProduct,u=t.getProducts,o=t.lineItems,c=t.getProductCount,i=n("automaticOffers"===e?u:o);return r.map((function(t){if(t){var r=i[t]||{},n=r.productId,u=r.variantId,o=r.quantity,a=r.lineItemHandle;return{productId:n,variantId:u,quantity:"automaticOffers"===e?c:o,unitPrice:0,lineItemHandle:a,discountType:e,discountValue:"Free"}}return{}}))},a=function(t){var e=t.offerCategory,r=t.buyOfferType,n=t.discountType,u=t.discountValue,o=t.lineItems,i=function(t){var e=t.customBuyCollection,r=t.customGetCollection,n=t.customBuyProduct,u=t.customGetProduct,o=u.length>0?u:n,c=r.length>0?r:e;return o.concat(c)}(t),a="overAll"===r?o:i,d="overAll"===r?function(t){return t.reduce((function(t,e){return t+e.unitPrice*e.quantity}),0)}(a):function(t,e){var r=0;return t.forEach((function(t){if(t){var n=e.reduce((function(e,r){var n=r||{},u=n.collectionId,o=n.variantId,c=n.quantity,i=n.unitPrice;return o!==t&&u!==t||(e+=c*i),e}),0);r+=n}})),r}(a,o),f="percentage"===n&&u>=100?100:u,l=[];return a.forEach((function(t){if(t&&"string"==typeof t)return o.forEach((function(r){var o=r||{},i=o.collectionId;if(o.variantId===t||i===t){var a=c(e,r,n,u,f,d);l.push(a)}}));var r=c(e,t,n,u,f,d);l.push(r)})),l},d=function(t){switch(t.offerCategory){case"percentageDiscount":case"flatDiscount":case"volumeDiscount":return function(t){return function(t){var e=t.getRemovedProductList,r=t.buyOfferType,n="overAll"!==r&&u(t),o="overAll"===r&&function(t){var e=t.cartType,r=t.cartValue;return t.lineItems.every((function(t){var n=t.quantity,u=t.unitPrice;return("amount"===e?n*u:n)>=r}))}(t);return{output:o||n?a(t):[],getRemovedProductList:e}}(t)}(t);case"buyXGetY":return function(t){var e=function(t){var e=t.getRemovedProductList,r=u(t),n=o(t);return{output:r&&n?i(t):[],getRemovedProductList:e}}(t);return e}(t);case"buyMoreSaveMore":return function(t){var e=function(t){var e=t.getRemovedProductList,r=t.getProductCount,n=u(t),c=0===r||o(t);return{output:n&&c?a(t):[],getRemovedProductList:e}}(t);return e}(t);case"automaticOffers":return function(t){var e=function(t){var e=t.getRemovedProductList;return{output:u(t)?i(t):[],getRemovedProductList:e}}(t);return e}(t);default:return{}}},f=function(t){return t},l=function(t,e){var u=t.cartLineItems,o=(void 0===u?{}:u).lineItems,c=void 0===o?[]:o;if(0===c.length)return JSON.stringify({output:[],getRemovedProductList:[]});var i=function(t){var e=t.buyCollections,r=t.getCollections,n=t.buyProducts,u=t.getProducts,o=t.getProductCount,c=n.map((function(t){return t.variantId}));t.customBuyProduct=c;var i=u.map((function(t){return t.variantId}));t.customGetProduct=i;var a=e.map((function(t){return t.collectionId}));t.customBuyCollection=a;var d=r.map((function(t){return t.collectionId}));return t.customGetCollection=d,o||(t.getProductCount=0),t}(e),a=function(t,e){var u=function(t){return t.filter((function(t){var e=t.lineItemType,r=t.originalUnitPrice;return t.unitPrice=r,"READONLY"===e}))}(e)||[];return e=function(t,e,r,u){return u=n(u),e.forEach((function(e){var r=u[e]||{},n=r.lineItemType,o=r.variantId,c=r.originalUnitPrice;"automaticOffers"===t&&o===e&&"READONLY"===n?delete u[e]:o===e&&"READONLY"===n&&(u[e].unitPrice=c)})),r.forEach((function(e){var r=u[e]||{},n=r.lineItemType,o=r.variantId,c=r.originalUnitPrice;"automaticOffers"===t&&o===e&&"READONLY"===n?delete u[e]:o===e&&"READONLY"===n&&(u[e].unitPrice=c)})),u=Object.values(u)}(t.offerCategory,t.customGetProduct,t.customBuyProduct,e),r(r({},t),{lineItems:e,getRemovedProductList:u})}(i,c),f=d(a);return JSON.stringify(f)};vajroPlugin=e})();
//# sourceMappingURL=vajroPlugin.js.map