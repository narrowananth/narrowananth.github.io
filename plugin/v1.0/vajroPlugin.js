var vajroPlugin;(()=>{"use strict";var t={d:(e,n)=>{for(var r in n)t.o(n,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:n[r]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{flow:()=>f});var n=function(){return n=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},n.apply(this,arguments)},r=function(t){return t.reduce((function(t,e){return t[e.variantId]=e,t}),{})},o=function(t){return t.reduce((function(t,e){return t+e.unitPrice*e.quantity}),0)},u=function(t,e,n){if("automaticOffers"!==n){var u=r(e);return t.reduce((function(t,e){var n=e.variantId,r=e.unitPrice,o=e.quantity,c=u[n]||{},i=c.unitPrice;return t+(i||0===i?i:r)*(c.quantity||o)}),0)}var c=o(t),i=function(t){return t.reduce((function(t,e){return t+e.customGetProductPrice*e.quantity}),0)}(e);return c+i},c=function(t){var e=t.cartType,n=t.cartValue,r=t.lineItems,o=function(t){var e=t.offerCategory,n=t.customBuyCollection,r=t.customGetCollection,o=t.customBuyProduct,u=t.customGetProduct,c=t.getProductCount,i=o.length>0||n.length>0?o.concat(n):[],a=0===c&&(u.length>0||r.length>0)?u.concat(r):[];return"automaticOffers"!==e?i.concat(a):i}(t);return o.reduce((function(t,n){return t+r.reduce((function(t,r){var o=r||{},u=o.collectionId,c=o.variantId,i=o.quantity,a=o.unitPrice;return c!==n&&u!==n||(t+="amount"===e?i*a:i),t}),0)}),0)>=n},i=function(t){var e=t.cartType,n=t.cartValue;return t.lineItems.reduce((function(t,n){var r=n.quantity,o=n.unitPrice;return t+("amount"===e?r*o:r)}),0)>=n},a=function(t){var e=t.customGetProduct,n=t.customGetCollection,r=t.lineItems;return e.concat(n).some((function(t){return r.some((function(e){var n=e||{},r=n.collectionId;return n.variantId===t||r===t}))}))},d=function(t,e,n,r,o,u){var c=e||{},i=c.unitPrice,a=c.quantity,d=c.variantId,l=c.productId,f=c.lineItemHandle;if("percentage"===n)return{productId:l,variantId:d,quantity:a,unitPrice:(s=a*i-a*i*(o/100))/a,lineItemHandle:f,discountType:t,discountValue:"You got ".concat(o,"% off"),customLineItemType:"REGULAR"};if("amount"===n){var s,v=a*i/u*100/100*r;return{productId:l,variantId:d,quantity:a,unitPrice:0!=(s=a*i>=v?a*i-v:0)?s/a:0,lineItemHandle:f,discountType:t,discountValue:"You save {{currency}}".concat(v.toFixed(3)),customLineItemType:"REGULAR"}}return{}},l=function(t){var e=t.offerCategory,n=t.getProductCount,r=t.customGetProductId,o=t.customGetVariantId,u=t.isGetProductIdInLineitem,c=t.productId,i=t.variantId,a=t.lineItemHandle,d=t.quantity,l=void 0===d?n:d,f=t.unitPrice,s=t.customGetProductPrice,v=u&&n>l?n:l;return{productId:c||r,variantId:i||o,quantity:v,freeQuantity:n,unitPrice:v===n?0:f,lineItemHandle:a,discountType:v>=n?e:"",discountValue:v>=n?"Buy ".concat(v,", Get ").concat(n," Free and ").concat(v-n," For the Same Price."):"",customLineItemType:"REGULAR",isGetProductIdInLineitem:u,customGetProductPrice:s}},f=function(t,e){var f=t.cartLineItems.lineItems,s=e.map((function(t){var e=function(t){var e=t.buyCollections,n=void 0===e?[]:e,r=t.getCollections,o=void 0===r?[]:r,u=t.buyProducts,c=void 0===u?[]:u,i=t.getProducts,a=void 0===i?[]:i,d=t.getProductCount,l=c.map((function(t){return t.variantId}));t.customBuyProduct=l;var f=a.map((function(t){return t.variantId}));t.customGetProduct=f;var s=n.map((function(t){return t.collectionId}));t.customBuyCollection=s;var v=o.map((function(t){return t.collectionId}));return t.customGetCollection=v,d||(t.getProductCount=0),t}(t),s=function(t,e){var r=function(t){return t.map((function(t){var e=t.originalUnitPrice;return t.unitPrice=e,t}))}(e)||[],o=function(t){return t.map((function(t){var e=t.originalUnitPrice;return t.unitPrice=e,t}))}(e);return n(n({getConfigSchema:t},t),{lineItems:o,getRemovedProductList:r})}(e,f);return function(t){switch(t.offerCategory){case"percentageDiscount":case"flatDiscount":return function(t){var e=t.getRemovedProductList,n=t.lineItems,r=t.buyOfferType,l=t.customGetProduct,f=t.customGetCollection,s=t.displayText,v=void 0===s?"":s,m=t.getConfigSchema,I=t.offerCategory,g="overAll"!==r&&c(t),P="overAll"===r||!(l.length>0||f.length>0)||function(t){var e=t.customBuyProduct,n=t.customBuyCollection,r=t.lineItems;return e.concat(n).some((function(t){return r.some((function(e){var n=e||{},r=n.collectionId;return n.variantId===t||r===t}))}))}(t),y="overAll"===r||!(l.length>0||f.length>0)||a(t),p="overAll"!==r||!(l.length>0||f.length>0)||a(t),h=("overAll"===r&&p&&i(t)||g)&&P&&y?function(t){var e=t.offerCategory,n=t.buyOfferType,r=t.discountType,u=t.discountValue,c=t.lineItems,i=t.customGetProduct,a=t.customGetCollection,l=function(t){var e=t.customBuyCollection,n=t.customGetCollection,r=t.customBuyProduct,o=t.customGetProduct,u=o.length>0?o:r,c=n.length>0?n:e,i=r.length>0&&n.length>0?n:[],a=o.length>0&&e.length>0?o:[];return i.length>0||a.length>0?i.concat(a):u.concat(c)}(t),f="overAll"===n&&i.length<=0&&a.length<=0?c:l,s="overAll"===n?o(f):function(t){var e=t.lineItems;return t.sanitizedLineItem.reduce((function(t,n){return t+e.reduce((function(t,e){var r=e||{},o=r.collectionId,u=r.variantId,c=r.quantity,i=r.unitPrice;return u!==n&&o!==n||(t+=c*i),t}),0)}),0)}({sanitizedLineItem:f,lineItems:c}),v="percentage"===r&&u>=100?100:u,m=[];return f.forEach((function(t){"string"==typeof t&&c.forEach((function(n){var o=n||{},c=o.collectionId;if(o.variantId===t||c===t){var i=d(e,n,r,u,v,s);m.push(i)}}));var n=d(e,t,r,u,v,s);m.push(n)})),m}(t):[];return{output:h,getRemovedProductList:e,displayText:h.length>0&&v.length>0?v:"",totalCartValue:u(n,h,I),schema:m}}(t);case"buyXGetY":return function(t){var e=t.getRemovedProductList,n=t.getConfigSchema,o=t.lineItems,a=t.buyOfferType,d=t.displayText,f=t.offerCategory,s="overAll"!==a?c(t):i(t),v=function(t){var e=t.customGetProduct,n=t.getProductCount,r=t.lineItems;return e.reduce((function(t,e){return t+r.reduce((function(t,n){var r=n||{},o=r.collectionId,u=r.variantId,c=r.quantity;return u!==e&&o!==e||(t+=c),t}),0)}),0)>=n}(t),m=s&&v?function(t){var e=t.offerCategory,n=t.getProducts,o=t.customGetProduct,u=t.lineItems,c=t.getProductCount,i=r(u),a=o.filter((function(t){return i[t]})).sort((function(t,e){return i[t].unitPrice-i[e].unitPrice})),d=[],f=c;return a.forEach((function(t,r){var o,u,c;if(f){var a=!!i[t],s=i[t]||{},v=s.productId,m=s.variantId,I=s.quantity,g=s.unitPrice,P=s.lineItemHandle,y=f>I?I:f;(f-=I)<0&&(f=0);var p=l({productId:v,variantId:m,lineItemHandle:P,quantity:I,getProductCount:y,unitPrice:g,offerCategory:e,customGetProductId:null===(o=n[r])||void 0===o?void 0:o.productId,customGetVariantId:null===(u=n[r])||void 0===u?void 0:u.variantId,customGetProductPrice:null===(c=n[r])||void 0===c?void 0:c.productPrice,isGetProductIdInLineitem:a});d.push(p)}})),d}(t):[];return{output:m,getRemovedProductList:e,displayText:m.length>0&&d.length>0?d:"",totalCartValue:u(o,m,f),schema:n}}(t);case"automaticOffers":return function(t){var e=t.getRemovedProductList,n=t.getConfigSchema,o=t.lineItems,a=t.buyOfferType,d=t.displayText,f=t.offerCategory,s=(t.cartValue,("overAll"!==a?c(t):i(t))?function(t){var e=t.offerCategory,n=t.getProducts,o=void 0===n?[]:n,u=t.customGetProduct,c=t.lineItems,i=t.getProductCount,a=r(c),d=[];return u.forEach((function(t,n){var r,u,c,f=!!a[t],s=a[t]||{},v=s.productId,m=s.variantId,I=s.quantity,g=s.unitPrice,P=s.lineItemHandle,y=l({productId:v,variantId:m,lineItemHandle:P,quantity:I,getProductCount:i,unitPrice:g,offerCategory:e,customGetProductId:null===(r=o[n])||void 0===r?void 0:r.productId,customGetVariantId:null===(u=o[n])||void 0===u?void 0:u.variantId,customGetProductPrice:null===(c=o[n])||void 0===c?void 0:c.productPrice,isGetProductIdInLineitem:f});d.push(y)})),d}(t):[]),v=s.length>0&&d.length>0?d:"",m=s.length>0?u(o,s,f):0;return 0===m?{}:{output:s,getRemovedProductList:e,displayText:v,totalCartValue:m,schema:n}}(t);default:return{}}}(s)})),v=s.sort((function(t,e){return t.totalCartValue-e.totalCartValue}));return JSON.stringify(v[0])};vajroPlugin=e})();
//# sourceMappingURL=vajroPlugin.js.map