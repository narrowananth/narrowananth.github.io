var vajroPlugin;(()=>{"use strict";var t={d:(e,n)=>{for(var i in n)t.o(n,i)&&!t.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:n[i]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{flow:()=>y,showMessage:()=>s});var n=function(t){var e=t.cartQuantity,n=t.buyProducts,i=t.getProducts,r=t.sanitizedLineItem,o=0,u=n.every((function(t){var e=t.variantId,n=r[e]?r[e].quantity:0;return o+=n,!!r[e]})),a=i.every((function(t){var e=t.variantId,n=r[e]?r[e].quantity:0;return o+=n,!!r[e]}));return!!(o>=e&&u&&a)},i=function(t){var e=t.offerCategory,n=t.overAll,i=t.getProductValid,r=t.getProductVariantIds,o=t.buyProductVariantIds,u=t.sanitizedLineItem,a=t.discountType,c=t.discountValue,d=c,l=0,s=i?r:o,y=n?Object.values(u):s;return y.forEach((function(t){var e=n?t:u[t],i=e.unitPrice,r=e.quantity;l+=i*r})),y.map((function(t){var i=n?t:u[t],r=i.unitPrice,o=i.quantity,s=i.variantId,y=i.productId,f=i.lineItemHandle;if("percentage"===a)return c>=100&&(d=100),{productId:y,variantId:s,quantity:o,unitPrice:(o*r-o*r*(d/100))/o,lineItemHandle:f,discountType:e,discountValue:"You got ".concat(d,"% off")};if("amount"===a){var v=o*r/l*100/100*c;return{productId:y,variantId:s,quantity:o,unitPrice:(o*r-v)/o,lineItemHandle:f,discountType:e,discountValue:"You save {{currency}}".concat(v.toFixed(3))}}return{}}))},r=function(t){var e=t.cartQuantity,n=(t.offerCategory,t.getCollectionValid),i=t.buyCollections,r=t.getCollections,o=t.sanitizedLineItem,u=[],a=[],c=0,d=0;return n&&r.forEach((function(t){t&&Object.values(o).forEach((function(e){var n=e.collectionId,i=e.variantId,r=e.quantity;n===t&&(d+=r,a.push(i))}))})),i.forEach((function(t){t&&Object.values(o).forEach((function(e){var n=e.collectionId,i=e.variantId,r=e.quantity;n===t&&(c+=r,u.push(i))}))})),(n?c+d:c)>=e?{buyCollectionsIdsValid:u,getCollectionsIdsValid:a}:{}},o=function(t){var e=t.offerCategory,n=t.getCollectionValue,i=t.buyCollectionValue,r=t.sanitizedLineItem,o=t.discountType,u=t.discountValue,a=u,c=0,d=[];if(n){var l=n.buyCollectionsIdsValid,s=n.getCollectionsIdsValid;l&&l.length>0&&s&&s.length>0&&(d=l.concat(s))}else(l=i.buyCollectionsIdsValid)&&l.length>0&&(d=l);return d.forEach((function(t){var e=r[t].unitPrice;c+=e})),d.map((function(t){var n=r[t],i=n.unitPrice,d=n.quantity,l=n.variantId,s=n.productId,y=n.lineItemHandle;if("percentage"===o)return u>=100&&(a=100),{productId:s,variantId:l,quantity:d,unitPrice:(d*i-d*i*(a/100))/d,lineItemHandle:y,discountType:e,discountValue:"You got ".concat(a,"% off")};var f=i/c*100/100*u;return{productId:s,variantId:l,quantity:d,unitPrice:(d*i-f)/d,lineItemHandle:y,discountType:e,discountValue:"You save {{currency}}".concat(f.toFixed(3))}}))},u=function(t){var e=t.cartQuantity,n=t.sanitizedLineItem,i=0;return Object.values(n).forEach((function(t){var e=t.quantity;i+=e})),i>=e},a=function(t){var e=t.cartQuantity,n=t.buyProducts,i=t.sanitizedLineItem,r=0;return n.forEach((function(t){var e=t.variantId,n=i[e]?i[e].quantity:0;r+=n})),r>=e},c=function(t){switch(t.offerCategory){case"percentageDiscount":case"flatDiscount":return function(t){return function(t){var e=t.lineItems,u=t.getRemovedProductList,a=t.offerCategory,c=t.overAll,d=t.getProductValid,l=t.getCollectionValid,s=t.collection,y=t.discountType,f=t.discountValue,v=t.buyCollections,I=t.buyCollectionsCount,g=t.getCollections,m=t.getCollectionsCount,P=t.buyProducts,p=t.getProducts,C=t.cartQuantity,b=P.flatMap((function(t){return t.variantId})),L=p.flatMap((function(t){return t.variantId})),V=e;if(c)return{output:A=i({offerCategory:a,overAll:c,sanitizedLineItem:V,discountType:y,discountValue:f}),getRemovedProductList:u};if(s){if(s){var T=!!l&&r({cartQuantity:C,offerCategory:a,getCollectionValid:l,buyCollections:v,getCollections:g,buyCollectionsCount:I,getCollectionsCount:m,sanitizedLineItem:V}),z=!l&&r({cartQuantity:C,offerCategory:a,buyCollections:v,buyCollectionsCount:I,sanitizedLineItem:V}),h=l?o({offerCategory:a,getCollectionValue:T,sanitizedLineItem:V,discountType:y,discountValue:f}):[],q=l?[]:o({offerCategory:a,buyCollectionValue:z,sanitizedLineItem:V,discountType:y,discountValue:f});return{getRemovedProductList:u,output:l?h:q}}return{getRemovedProductList:u,output:{}}}var Q=!!d&&n({cartQuantity:C,buyProducts:P,getProducts:p,sanitizedLineItem:V}),O=!d&&function(t){var e=t.cartQuantity,n=t.sanitizedLineItem,i=0,r=t.buyProducts.every((function(t){var e=t.variantId,r=n[e]?n[e].quantity:0;return i+=r,!!n[e]}));return!!(i>=e&&r)}({cartQuantity:C,buyProducts:P,sanitizedLineItem:V}),R=d&&Q?i({offerCategory:a,getProductValid:d,getProductVariantIds:L,sanitizedLineItem:V,discountType:y,discountValue:f}):[],A=!d&&O?i({offerCategory:a,getProductValid:d,buyProductVariantIds:b,sanitizedLineItem:V,discountType:y,discountValue:f}):[];return{output:d?R:A,getRemovedProductList:u}}(t)}(t);case"volumeDiscount":return function(t){var e=function(t){var e=t.lineItems,n=t.getRemovedProductList,c=t.overAll,d=t.cartQuantity,l=t.offerCategory,s=t.getCollectionValid,y=t.collection,f=t.discountType,v=t.discountValue,I=t.buyCollections,g=t.buyCollectionsCount,m=t.buyProducts,P=e;if(c)return{getRemovedProductList:n,output:u({cartQuantity:d,sanitizedLineItem:P})?i({offerCategory:l,overAll:c,sanitizedLineItem:P,discountType:f,discountValue:v}):[]};if(y){if(y){var p=!s&&r({cartQuantity:d,offerCategory:l,buyCollections:I,buyCollectionsCount:g,sanitizedLineItem:P});return{getRemovedProductList:n,output:s?[]:o({offerCategory:l,buyCollectionValue:p,sanitizedLineItem:P,discountType:f,discountValue:v})}}return{getRemovedProductList:n,output:{}}}var C=m.flatMap((function(t){return t.variantId}));return{getRemovedProductList:n,output:a({cartQuantity:d,buyProducts:m,sanitizedLineItem:P})?i({offerCategory:l,buyProductVariantIds:C,sanitizedLineItem:P,discountType:f,discountValue:v}):[]}}(t);return e}(t);case"buyXGetY":return function(t){var e=function(t){var e=t.lineItems,i=t.getRemovedProductList,r=t.offerCategory,o=t.cartQuantity,u=t.buyProducts,a=t.getProducts,c=e,d=n({cartQuantity:o,buyProducts:u,getProducts:a,sanitizedLineItem:c})?function(t){var e=t.offerCategory,n=t.sanitizedLineItem;return t.getProducts.map((function(t){var i=t.productId,r=t.variantId;return{productId:i,variantId:r,quantity:n[r].quantity,unitPrice:0,lineItemHandle:n[r].lineItemHandle,discountType:e,discountValue:"Free"}}))}({offerCategory:r,getProducts:a,sanitizedLineItem:c}):[];return{getRemovedProductList:i,output:d}}(t);return e}(t);case"buyMoreSaveMore":return function(t){var e=function(t){var e=t.lineItems,n=t.getRemovedProductList,i=t.offerCategory,r=t.cartTotal,o=t.buyProducts,u=t.getProducts,a=t.discountType,c=t.discountValue,d=e,l=function(t){var e=t.cartTotal,n=t.sanitizedLineItem,i=0;return t.buyProducts.forEach((function(t){var e=t.variantId,r=n[e]?n[e].unitPrice*n[e].quantity:0;i+=r})),i>=e}({cartTotal:r,buyProducts:o,sanitizedLineItem:d}),s=l?function(t){var e=t.offerCategory,n=t.buyProducts,i=t.sanitizedLineItem,r=t.discountType,o=t.discountValue,u=0;return"free"===r?t.getProducts.map((function(t){var n=t.productId,r=t.variantId;return{productId:n,variantId:r,quantity:i[r].quantity,unitPrice:0,lineItemHandle:i[r].lineItemHandle,discountType:e,discountValue:"Free"}})):(n.forEach((function(t){var e=t.variantId,n=i[e],r=n.unitPrice,o=n.quantity;u+=r*o})),n.map((function(t){var n=t.variantId,a=o,c=i[n],d=c.unitPrice,l=c.quantity,s=c.productId,y=c.lineItemHandle;if("percentage"===r)return o>=100&&(a=100),{productId:s,variantId:n,quantity:l,unitPrice:(l*d-l*d*(a/100))/l,lineItemHandle:y,discountType:e,discountValue:"You got ".concat(a,"% off")};if("amount"===r){var f=l*d/u*100/100*o;return{productId:s,variantId:n,quantity:l,unitPrice:(l*d-f)/l,lineItemHandle:y,discountType:e,discountValue:"You save {{currency}}".concat(f.toFixed(3))}}return{}})))}({offerCategory:i,buyProducts:o,getProducts:u,sanitizedLineItem:d,discountType:a,discountValue:c}):[];return{getRemovedProductList:n,output:s}}(t);return e}(t);case"automaticOffers":return function(t){return function(t){var e=t.lineItems,n=t.getRemovedProductList,i=t.offerCategory,o=t.onlyCartAmoutAndQunatity,c=t.collection,d=t.cartTotal,l=t.cartQuantity,s=t.buyProducts,y=t.getProducts,f=t.buyCollections,v=t.buyCollectionsCount,I=e,g=!!o&&function(t){var e=t.cartTotal,n=t.sanitizedLineItem,i=0;return Object.values(n).forEach((function(t){var e=t.unitPrice,n=t.quantity;i+=e*n})),i>=e}({cartTotal:d,sanitizedLineItem:I}),m=!!o&&u({cartQuantity:l,sanitizedLineItem:I}),P=a({buyProducts:s,sanitizedLineItem:I}),p=(c?r({offerCategory:i,buyCollections:f,buyCollectionsCount:v,sanitizedLineItem:I}):{}).buyCollectionsIdsValid;return g||m||P||p?{getRemovedProductList:n,output:y.map((function(t){return{productId:t.productId,variantId:t.variantId,quantity:t.count,unitPrice:0,discountType:i,discountValue:"Free"}}))}:{getRemovedProductList:n,output:{}}}(t)}(t);default:return{}}},d=function(){return d=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},d.apply(this,arguments)},l=function(t){return t.reduce((function(t,e){return t[e.variantId]=e,t}),{})},s=function(t){return t},y=function(t,e){var n=t.cartLineItems,i=(void 0===n?{}:n).lineItems,r=void 0===i?[]:i,o=function(t){var e=t.buyOfferType,n=t.cartType,i=t.cartValue,r=t.getCollections,o=t.getProducts;return t.onlyCartAmoutAndQunatity=!1,t.overAll="overAll"===e,t.collection="collections"===e,"amount"===n?(t.onlyCartAmoutAndQunatity=!0,t.cartTotal=i):t.cartTotal=0,"count"===n?(t.onlyCartAmoutAndQunatity=!0,t.cartQuantity=i):t.cartQuantity=0,r.length>0?t.getCollectionValid=!0:t.getCollectionValid=!1,o.length>0?t.getProductValid=!0:t.getProductValid=!1,t}(e),u=function(t,e){var n=function(t){return t.filter((function(t){var e=t.lineItemType,n=t.originalUnitPrice;return t.unitPrice=n,"READONLY"===e}))}(e)||[];return e=function(t,e,n,i){var r=e.map((function(t){return t.variantId})),o=n.map((function(t){return t.variantId}));return i=l(i),r.forEach((function(e){var n=i[e]||{},r=n.lineItemType,o=n.variantId,u=n.originalUnitPrice;"automaticOffers"===t&&o===e&&"READONLY"===r?delete i[e]:o===e&&"READONLY"===r&&(i[e].unitPrice=u)})),o.forEach((function(e){var n=i[e]||{},r=n.lineItemType,o=n.variantId,u=n.originalUnitPrice;"automaticOffers"===t&&o===e&&"READONLY"===r?delete i[e]:o===e&&"READONLY"===r&&(i[e].unitPrice=u)})),i}(t.offerCategory,t.getProducts,t.buyProducts,e),d(d({},t),{lineItems:e,getRemovedProductList:n})}(o,r),a=c(u);return JSON.stringify(a)};vajroPlugin=e})();
//# sourceMappingURL=vajroPlugin.js.map