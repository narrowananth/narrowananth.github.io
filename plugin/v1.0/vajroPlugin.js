var vajroPlugin;(()=>{"use strict";var t={d:(e,n)=>{for(var i in n)t.o(n,i)&&!t.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:n[i]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{flow:()=>f,showMessage:()=>v});var n=function(t){var e=t.overAll,n=t.getProductValid,i=t.getProductVariantIds,u=t.buyProductVariantIds,o=t.sanitizedLineItem,r=t.discountType,a=t.discountValue,c=a,d=0,l=n?i:u,s=e?Object.values(o):l;return s.forEach((function(t){var n=e?t:o[t],i=n.unitPrice,u=n.quantity;d+=i*u})),s.map((function(t){var n=e?t:o[t],i=n.unitPrice,u=n.quantity,l=n.variantId,s=n.productId,y=n.lineItemHandle;if("percentage"===r)return a>=100&&(c=100),{productId:s,variantId:l,quantity:u,unitPrice:(u*i-u*i*(c/100))/u,lineItemHandle:y,discountType:r,discountValue:c};var v=u*i/d*100/100*a;return{productId:s,variantId:l,quantity:u,unitPrice:(u*i-v)/u,lineItemHandle:y,discountType:r,discountValue:v}}))},i=function(t){var e=t.offerCategory,n=t.getCollectionValid,i=t.buyCollections,u=t.buyCollectionsCount,o=t.getCollections,r=t.getCollectionsCount,a=t.sanitizedLineItem,c=[],d=[],l=0,s=0;return n&&o.split(",").forEach((function(t){t&&Object.values(a).forEach((function(e){var n=e.collectionId,i=e.variantId,u=e.quantity;n===t&&(s+=u,d.push(i))}))})),i.split(",").forEach((function(t){t&&Object.values(a).forEach((function(e){var n=e.collectionId,i=e.variantId,u=e.quantity;n===t&&(l+=u,c.push(i))}))})),"volumeDiscount"===e||"automaticOffers"===e?(n?s>=r&&l>=u:l>=u)?{buyCollectionsIdsValid:c,getCollectionsIdsValid:d}:{}:{buyCollectionsIdsValid:c,getCollectionsIdsValid:d}},u=function(t){var e=t.getCollectionValue,n=t.buyCollectionValue,i=t.sanitizedLineItem,u=t.discountType,o=t.discountValue,r=o,a=0,c=[];if(e){var d=e.buyCollectionsIdsValid,l=e.getCollectionsIdsValid;d&&d.length>0&&l&&l.length>0&&(c=d.concat(l))}else(d=n.buyCollectionsIdsValid)&&d.length>0&&(c=d);return c.forEach((function(t){var e=i[t].unitPrice;a+=e})),c.map((function(t){var e=i[t],n=e.unitPrice,c=e.quantity,d=e.variantId,l=e.productId;return"percentage"===u?(o>=100&&(r=100),{productId:l,variantId:d,quantity:c,unitPrice:(c*n-c*n*(r/100))/c}):{productId:l,variantId:d,quantity:c,unitPrice:n-n/a*100/100*o}}))},o=function(t){var e=t.buyProducts,n=t.sanitizedLineItem;return!!e.every((function(t){var e=t.variantId,i=t.count;return!!e&&n[e].quantity>=i}))},r=function(t){var e=t.getProducts,n=t.sanitizedLineItem;return e.map((function(t){var e=t.productId,i=t.variantId,u=t.count,o=n[i].quantity>=u,r=o?0:n[i].unitPrice,a={productId:e,variantId:i,quantity:n[i].quantity,unitPrice:r,lineItemHandle:n[i].lineItemHandle,discountType:"free",discountValue:n[i].unitPrice};return o?a:null}))},a=function(t){var e=t.cartQuantity,n=t.sanitizedLineItem,i=0;return Object.values(n).forEach((function(t){var e=t.quantity;i+=e})),i>=e},c=function(t){var e=t.cartTotal,n=t.sanitizedLineItem,i=0;return Object.values(n).forEach((function(t){var e=t.unitPrice,n=t.quantity;i+=e*n})),i>=e},d=function(t){var e=t.getProducts,n=t.sanitizedLineItem,i=t.discountType,u=t.discountValue,o=0;return e.forEach((function(t){var e=t.variantId,i=n[e],u=i.unitPrice,r=i.quantity;o+=u*r})),e.map((function(t){var e=t.variantId,r=t.amount,a=u,c=n[e].unitPrice*n[e].quantity>=r,d=n[e],l=d.unitPrice,s=d.quantity,y=d.productId,v=d.lineItemHandle;if(c){if("percentage"===i)return u>=100&&(a=100),{productId:y,variantId:e,quantity:s,unitPrice:(s*l-s*l*(a/100))/s,lineItemHandle:v,discountType:i,discountValue:a};var f=s*l/o*100/100*u;return{productId:y,variantId:e,quantity:s,unitPrice:(s*l-f)/s,lineItemHandle:v,discountType:i,discountValue:f}}}))},l=function(t){switch(t.offerCategory){case"percentageDiscount":case"flatDiscount":return function(t){return function(t){var e=t.lineItems,o=t.getRemovedProductList,r=t.offerCategory,a=t.overAll,c=t.getProductValid,d=t.getCollectionValid,l=t.collection,s=t.discountType,y=t.discountValue,v=t.buyCollections,f=t.buyCollectionsCount,I=t.getCollections,m=t.getCollectionsCount,P=t.buyProducts,g=t.getProducts,p=P.flatMap((function(t){return t.variantId})),C=g.flatMap((function(t){return t.variantId})),L=e;if(a)return{output:O=n({overAll:a,sanitizedLineItem:L,discountType:s,discountValue:y}),getRemovedProductList:o};if(l){if(l){var b=!!d&&i({offerCategory:r,getCollectionValid:d,buyCollections:v,getCollections:I,buyCollectionsCount:f,getCollectionsCount:m,sanitizedLineItem:L}),V=!d&&i({offerCategory:r,buyCollections:v,buyCollectionsCount:f,sanitizedLineItem:L}),z=d?u({getCollectionValue:b,sanitizedLineItem:L,discountType:s,discountValue:y}):[],T=d?[]:u({buyCollectionValue:V,sanitizedLineItem:L,discountType:s,discountValue:y});return{getRemovedProductList:o,output:d?z:T}}return{getRemovedProductList:o,output:{}}}var q=!!c&&function(t){var e=t.getProducts,n=t.sanitizedLineItem,i=t.buyProducts.every((function(t){var e=t.variantId,i=t.count;return n[e]&&n[e].quantity>=i})),u=e.every((function(t){var e=t.variantId,i=t.count;return n[e]&&n[e].quantity>=i}));return!(!i||!u)}({buyProducts:P,getProducts:g,sanitizedLineItem:L}),R=!c&&function(t){var e=t.sanitizedLineItem;return!!t.buyProducts.every((function(t){var n=t.variantId,i=t.count;return e[n]&&e[n].quantity>=i}))}({buyProducts:P,sanitizedLineItem:L}),h=c&&q?n({getProductValid:c,getProductVariantIds:C,sanitizedLineItem:L,discountType:s,discountValue:y}):[],O=!c&&R?n({getProductValid:c,buyProductVariantIds:p,sanitizedLineItem:L,discountType:s,discountValue:y}):[];return{output:c?h:O,getRemovedProductList:o}}(t)}(t);case"volumeDiscount":return function(t){var e=function(t){var e=t.lineItems,r=t.getRemovedProductList,c=t.overAll,d=t.cartQuantity,l=t.offerCategory,s=t.getCollectionValid,y=t.collection,v=t.discountType,f=t.discountValue,I=t.buyCollections,m=t.buyCollectionsCount,P=t.buyProducts,g=e;if(c)return{getRemovedProductList:r,output:a({cartQuantity:d,sanitizedLineItem:g})?n({overAll:c,sanitizedLineItem:g,discountType:v,discountValue:f}):[]};if(y){if(y){var p=!s&&i({offerCategory:l,buyCollections:I,buyCollectionsCount:m,sanitizedLineItem:g});return{getRemovedProductList:r,output:s?[]:u({buyCollectionValue:p,sanitizedLineItem:g,discountType:v,discountValue:f})}}return{getRemovedProductList:r,output:{}}}var C=P.flatMap((function(t){return t.variantId}));return{getRemovedProductList:r,output:o({buyProducts:P,sanitizedLineItem:g})?n({buyProductVariantIds:C,sanitizedLineItem:g,discountType:v,discountValue:f}):[]}}(t);return e}(t);case"buyXGetY":return function(t){var e=function(t){var e=t.lineItems,n=t.getRemovedProductList,i=t.onlyCartAmoutAndQunatity,u=t.cartQuantity,c=t.buyProducts,d=t.getProducts,l=e;return i?{getRemovedProductList:n,output:a({cartQuantity:u,sanitizedLineItem:l})?r({getProducts:d,sanitizedLineItem:l}):[]}:{getRemovedProductList:n,output:o({buyProducts:c,sanitizedLineItem:l})?r({getProducts:d,sanitizedLineItem:l}):[]}}(t);return e}(t);case"buyMoreSaveMore":return function(t){var e=function(t){var e=t.lineItems,n=t.getRemovedProductList,i=t.onlyCartAmoutAndQunatity,u=t.cartTotal,o=t.buyProducts,r=t.getProducts,a=t.discountType,l=t.discountValue,s=e;if(i)return{getRemovedProductList:n,output:c({cartTotal:u,sanitizedLineItem:s})?d({getProducts:r,sanitizedLineItem:s,discountType:a,discountValue:l}):[]};var y=function(t){var e=t.sanitizedLineItem;return!!t.buyProducts.every((function(t){var n=t.variantId,i=t.amount;return!!n&&e[n].unitPrice*e[n].quantity>=i}))}({buyProducts:o,sanitizedLineItem:s});return{getRemovedProductList:n,output:y?d({getProducts:r,sanitizedLineItem:s,discountType:a,discountValue:l}):[]}}(t);return e}(t);case"automaticOffers":return function(t){var e=function(t){var e=t.lineItems,n=t.getRemovedProductList,u=t.offerCategory,r=t.onlyCartAmoutAndQunatity,d=t.collection,l=t.cartTotal,s=t.cartQuantity,y=t.buyProducts,v=t.getProducts,f=t.buyCollections,I=t.buyCollectionsCount,m=e,P=!!r&&c({cartTotal:l,sanitizedLineItem:m}),g=!!r&&a({cartQuantity:s,sanitizedLineItem:m}),p=o({buyProducts:y,sanitizedLineItem:m}),C=(d?i({offerCategory:u,buyCollections:f,buyCollectionsCount:I,sanitizedLineItem:m}):{}).buyCollectionsIdsValid;return P||g||p||C?{getRemovedProductList:n,output:v.map((function(t){return{productId:t.productId,variantId:t.variantId,quantity:t.count,unitPrice:0}}))}:{getRemovedProductList:n,output:{}}}(t);return e}(t);default:return{}}},s=function(){return s=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var u in e=arguments[n])Object.prototype.hasOwnProperty.call(e,u)&&(t[u]=e[u]);return t},s.apply(this,arguments)},y=function(t){return t.reduce((function(t,e){return t[e.variantId]=e,t}),{})},v=function(t){return t},f=function(t,e){var n,i,u,o=t.cartLineItems,r=(void 0===o?{}:o).lineItems,a=(n=e,u=function(t){return t.filter((function(t){var e=t.lineItemType,n=t.originalUnitPrice;return t.unitPrice=n,"READONLY"===e}))}(i=void 0===r?[]:r)||[],i=function(t,e,n){var i=t.map((function(t){return t.variantId})),u=e.map((function(t){return t.variantId}));return n=y(n),i.forEach((function(t){var e=n[t]||{},i=e.lineItemType,u=e.variantId,o=e.originalUnitPrice;u===t&&"READONLY"===i&&(n[t].unitPrice=o)})),u.forEach((function(t){var e=n[t]||{},i=e.lineItemType,u=e.variantId,o=e.originalUnitPrice;u===t&&"READONLY"===i&&(n[t].unitPrice=o)})),n}(n.getProducts,n.buyProducts,i),s(s({},n),{lineItems:i,getRemovedProductList:u})),c=l(a);return JSON.stringify(c)};vajroPlugin=e})();
//# sourceMappingURL=vajroPlugin.js.map