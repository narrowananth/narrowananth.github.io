var vajroPlugin;(()=>{"use strict";var t={d:(e,n)=>{for(var r in n)t.o(n,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:n[r]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{flow:()=>l,showMessage:()=>d});var n=function(){return n=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var u in e=arguments[n])Object.prototype.hasOwnProperty.call(e,u)&&(t[u]=e[u]);return t},n.apply(this,arguments)},r=function(t){var e=t.cartType,n=t.cartValue,r=t.lineItems,u=function(t){var e=t.offerCategory,n=t.buyCollections,r=t.getCollections,u=t.buyProducts,o=t.getProducts,i=t.getProductCount,c=u.length>0||n.length>0?u.concat(n):[],a=0===i&&(o.length>0||r.length>0)?o.concat(r):[];return"automaticOffers"!==e?c.concat(a):c}(t);return u.every((function(t){return!!t&&r.reduce((function(n,r){var u=r||{},o=u.collectionId,i=u.variantId,c=u.quantity,a=u.unitPrice;return i!==t&&o!==t||(n+="amount"===e?c*a:c),n}),0)>=n}))},u=function(t){var e=t.getProducts,n=t.getProductCount,r=t.lineItems;return e.every((function(t){return!!t&&r.reduce((function(e,n){var r=n||{},u=r.collectionId,o=r.variantId,i=r.quantity;return o!==t&&u!==t||(e+=i),e}),0)>=n}))},o=function(t,e,n,r,u,o){var i=e||{},c=i.unitPrice,a=i.quantity,d=i.variantId,l=i.productId,f=i.lineItemHandle;if("percentage"===n)return{productId:l,variantId:d,quantity:a,unitPrice:(a*c-a*c*(u/100))/a,lineItemHandle:f,discountType:t,discountValue:"You got ".concat(u,"% off")};if("amount"===n){var v=a*c/o*100/100*r;return{productId:l,variantId:d,quantity:a,unitPrice:(a*c-v)/a,lineItemHandle:f,discountType:t,discountValue:"You save {{currency}}".concat(v.toFixed(3))}}return"free"===n?{productId:l,variantId:d,quantity:a,unitPrice:0,lineItemHandle:f,discountType:t,discountValue:"Free"}:{}},i=function(t){var e=t.offerCategory,n=t.getProducts,r=t.lineItems,u=t.getProductCount,o=function(t){return t.reduce((function(t,e){return t[e.variantId]=e,t}),{})}(r);return n.map((function(t){if(t){var n=o[t]||{},r=n.productId,i=n.variantId,c=n.quantity,a=n.lineItemHandle;return{productId:r,variantId:i,quantity:"automaticOffers"===e?u:c,unitPrice:0,lineItemHandle:a,discountType:e,discountValue:"Free"}}return{}}))},c=function(t){var e=t.offerCategory,n=t.buyOfferType,r=t.discountType,u=t.discountValue,i=t.lineItems,c=function(t){var e=t.buyCollections,n=t.getCollections,r=t.buyProducts,u=t.getProducts,o=u.length>0?u:r,i=n.length>0?n:e;return o.concat(i)}(t),a="overAll"===n?i:c,d="overAll"===n?function(t){return t.reduce((function(t,e){return t+e.unitPrice*e.quantity}),0)}(a):function(t,e){var n=0;return t.forEach((function(t){if(t){var r=e.reduce((function(e,n){var r=n||{},u=r.collectionId,o=r.variantId,i=r.quantity,c=r.unitPrice;return o!==t&&u!==t||(e+=i*c),e}),0);n+=r}})),n}(a,i),l="percentage"===r&&u>=100?100:u,f=[];return a.forEach((function(t){if(t&&"string"==typeof t)return i.forEach((function(n){var i=n||{},c=i.collectionId;if(i.variantId===t||c===t){var a=o(e,n,r,u,l,d);f.push(a)}}));var n=o(e,t,r,u,l,d);f.push(n)})),f},a=function(t){switch(t.offerCategory){case"percentageDiscount":case"flatDiscount":case"volumeDiscount":return function(t){return function(t){var e=t.getRemovedProductList,n=t.buyOfferType,u="overAll"!==n&&r(t),o="overAll"===n&&function(t){var e=t.cartType,n=t.cartValue;return t.lineItems.every((function(t){var r=t.quantity,u=t.unitPrice;return("amount"===e?r*u:r)>=n}))}(t);return{output:o||u?c(t):[],getRemovedProductList:e}}(t)}(t);case"buyXGetY":return function(t){var e=function(t){var e=t.getRemovedProductList,n=r(t),o=u(t);return{output:n&&o?i(t):[],getRemovedProductList:e}}(t);return e}(t);case"buyMoreSaveMore":return function(t){var e=function(t){var e=t.getRemovedProductList,n=t.getProductCount,o=r(t),i=0===n||u(t);return{output:o&&i?c(t):[],getRemovedProductList:e}}(t);return e}(t);case"automaticOffers":return function(t){var e=function(t){var e=t.getRemovedProductList;return{output:r(t)?i(t):[],getRemovedProductList:e}}(t);return e}(t);default:return{}}},d=function(t){return t},l=function(t,e){var r=t.cartLineItems,u=(void 0===r?{}:r).lineItems,o=void 0===u?[]:u;if(0===o.length)return JSON.stringify({output:[],getRemovedProductList:[]});var i=function(t){var e=t.buyCollections,n=t.getCollections,r=t.buyProducts,u=t.getProducts,o=t.getProductCount;if(r.length>0){var i=r.map((function(t){return t.variantId}));t.buyProducts=i}if(u.length>0){var c=u.map((function(t){return t.variantId}));t.getProducts=c}if(e.length>0){var a=e.map((function(t){return t.collectionId}));t.buyCollections=a}if(n.length>0){var d=n.map((function(t){return t.collectionId}));t.getCollections=d}return o||(t.getProductCount=0),t}(e),c=function(t,e){return n(n({},t),{lineItems:e,getRemovedProductList:[]})}(i,o),d=a(c);return JSON.stringify(d)};vajroPlugin=e})();
//# sourceMappingURL=vajroPlugin.js.map