var vajroPlugin;(()=>{"use strict";var t={d:(e,n)=>{for(var r in n)t.o(n,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:n[r]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{getBuyXGetY:()=>p,showMessage:()=>P,vajroPlugins:()=>m});var n=function(t){var e=t.getProductValid,n=t.getProductVariantIds,r=t.buyProductVariantIds,u=t.sanitizedLineItem,i=t.discountType,o=t.discountValue,a=o;return(e?n:r).map((function(t){var e=u[t],n=e.unitPrice,r=e.quantity,c=e.variantId,d=e.productId;return"percentage"===i?(o>=100&&(a=100),{productId:d,variantId:c,quantity:r,unitPrice:r*n-r*n*(a/100)}):{productId:d,variantId:c,quantity:r,unitPrice:r*(o>=n?o:n)-o}}))},r=function(t){var e=t.lineItems,r=t.getRemovedProductList,u=t.getProductValid,i=t.buyCollection,o=t.discountType,a=t.discountValue,c=(t.buyCollectionValue,t.buyProducts),d=t.getProducts,f=c.flatMap((function(t){return t.variantId})),s=d.flatMap((function(t){return t.variantId})),l=e;if(i)return{};var g=!!u&&function(t){var e=t.getProductVariantIds,n=t.sanitizedLineItem,r=t.buyProductVariantIds.every((function(t){return n[t]})),u=e.every((function(t){return n[t]}));return!(!r||!u)}({buyProductVariantIds:f,getProductVariantIds:s,sanitizedLineItem:l}),v=!u&&function(t){var e=t.sanitizedLineItem;return!!t.buyProductVariantIds.every((function(t){return e[t]}))}({buyProductVariantIds:f,sanitizedLineItem:l}),y=u&&g?n({getProductValid:u,getProductVariantIds:s,sanitizedLineItem:l,discountType:o,discountValue:a}):[],p=!u&&v?n({getProductValid:u,buyProductVariantIds:f,sanitizedLineItem:l,discountType:o,discountValue:a}):[];return{output:u?y:p,getRemovedProductList:r}},u=function(){return u=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var u in e=arguments[n])Object.prototype.hasOwnProperty.call(e,u)&&(t[u]=e[u]);return t},u.apply(this,arguments)},i=function(t,e){var n=a(e)||[],r=t.getProducts,i=t.buyProducts;return e=o(r,i,e),u(u({},t),{lineItems:e,getRemovedProductList:n})},o=function(t,e,n){var r=t.map((function(t){return t.variantId})),u=e.map((function(t){return t.variantId}));return n=c(n),r.forEach((function(t){var e=n[t]||{},r=e.lineItemType;e.variantId===t&&"READONLY"===r&&(n[t].lineItemType="REGULAR",n[t].unitPrice=n[t].originalUnitPrice)})),u.forEach((function(t){var e=n[t]||{},r=e.lineItemType;e.variantId===t&&"READONLY"===r&&(n[t].lineItemType="REGULAR",n[t].unitPrice=n[t].originalUnitPrice)})),n},a=function(t){return t.filter((function(t){return"READONLY"===t.lineItemType}))},c=function(t){return t.reduce((function(t,e){return t[e.variantId]=e,t}),{})},d=function(t,e,n){var r=[];return"include"===n?Object.keys(t).forEach((function(n){e[n]&&r.push(t[n])})):"exclude"===n&&Object.keys(t).forEach((function(n){e[n]||r.push(t[n])})),r},f=function(t){var e=t.lineItems,n=t.includeProducts,r=t.excludeProducts,u=c(n),i=c(r),o=0!==Object.keys(u).length?d(e,u,"include"):[],a=0!==Object.keys(i).length?d(e,i,"exclude"):[],f=o.length?o:a,s=c(f);return 0!==f.length?s:e},s=function(){return s=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var u in e=arguments[n])Object.prototype.hasOwnProperty.call(e,u)&&(t[u]=e[u]);return t},s.apply(this,arguments)},l=function(t){var e=t.getOfferConfig,n=e.buyProducts,r=e.buyProductQuantity,u=function(t,e,n){for(var r=!1,u=0,i=t;u<i.length;u++){var o=i[u],a=(n[o]||{}).quantity;if(!(n[o]&&e<=a)){r=!1;break}r=!0}return{offerFlag:r}}(n.map((function(t){return t.variantId})),r,f(t)),i=function(t,e){var n=t.offerFlag,r=e.getOfferType,u=e.getOfferConfig,i=u.getProducts,o=u.getProductQuantity,a=0!==i.length?i.length:1,c=u.discount;return c="amount"===r?c/a:c,n?i.map((function(t){var e=t.unitPrice,n=0;return"product"!==r&&("percentage"===r?c>=100&&(c=100):"amount"===r&&c>=e&&(e=c),n="percentage"===r?o*e-o*e*(c/100):o*e-c),s(s({},t),{quantity:o,unitPrice:n})})):[]}(u,t);return i},g=function(){return g=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var u in e=arguments[n])Object.prototype.hasOwnProperty.call(e,u)&&(t[u]=e[u]);return t},g.apply(this,arguments)},v=function(t){var e=function(t,e){var n=t.offerFlag,r=t.total,u=e.getOfferType,i=e.getOfferConfig,o=i.threshold,a=i.getProducts,c=i.getProductQuantity,d=0!==a.length?a.length:1,f=i.discount;return f="amount"===u?f/d:f,n&&o<=r?a.map((function(t){var e=t.unitPrice,n=0;return"product"!==u&&("percentage"===u?f>=100&&(f=100):"amount"===u&&f>=e&&(e=f),n="percentage"===u?c*e-c*e*(f/100):c*e-f),g(g({},t),{quantity:c,unitPrice:n})})):[]}(function(t,e){for(var n=!1,r=0,u=0,i=t;u<i.length;u++){var o=e[i[u]]||{},a=o.quantity,c=o.unitPrice;if(!a||!c){n=!1;break}r+=a*c,n=!0}return{offerFlag:n,total:r}}(t.getOfferConfig.buyProducts.map((function(t){return t.variantId})),f(t)),t);return e},y=function(t){switch(t.getConfigSchema.offerCategory){case"percentageDiscount":return function(t){var e=t.getConfigSchema,n=t.lineItems,u=i(e,n);return r(u)}(t);case"flatDiscount":return function(t){var e=t.getConfigSchema,n=t.lineItems,u=i(e,n);return r(u)}(t);case"volumeDiscount":return function(t){var e=t.getConfigSchema,r=t.lineItems,u=function(t){var e=t.lineItems,r=(t.getConfigSchema,t.getRemovedProductList),u=t.buyCollection,i=t.discountType,o=t.discountValue,a=(t.buyCollectionValue,t.buyProducts);if(u)return{};var c=a.flatMap((function(t){return t.variantId})),d=e,f=function(t){var e=t.sanitizedLineItem;return!!t.buyProducts.every((function(t){var n,r=t.variantId,u=t.count;return!!r&&(null===(n=e[r])||void 0===n?void 0:n.quantity)>=u}))}({buyProducts:a,sanitizedLineItem:d});return{getRemovedProductList:r,output:f?n({buyProductVariantIds:c,sanitizedLineItem:d,discountType:i,discountValue:o}):[]}}(i(e,r));return u}(t);default:return{}}},p=function(t,e){var n=t.cartLineItems,r=(void 0===n?{}:n).lineItems,u=function(t){switch(t.buyOfferType){case"threshold":return function(t){var e=t.getRemovedProductList;return{getSplitDiscount:v(t),getRemovedProductList:e}}(t);case"collection":case"product":default:return{};case"quantity":return function(t){var e=t.getRemovedProductList;return{getSplitDiscount:l(t),getRemovedProductList:e}}(t)}}(i(e,void 0===r?[]:r));return JSON.stringify(u)},P=function(t){return t},m=function(t,e){var n=t.cartLineItems,r=(void 0===n?{}:n).lineItems,u=y({lineItems:void 0===r?[]:r,getConfigSchema:e});return JSON.stringify(u)};vajroPlugin=e})();
//# sourceMappingURL=vajroPlugin.js.map