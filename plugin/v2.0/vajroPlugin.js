var vajroPlugin;(()=>{"use strict";var t={d:(e,n)=>{for(var i in n)t.o(n,i)&&!t.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:n[i]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{flow:()=>V,getBuyXGetY:()=>L,showMessage:()=>h});var n=function(t){var e=t.overAll,n=t.getProductValid,i=t.getProductVariantIds,r=t.buyProductVariantIds,u=t.sanitizedLineItem,o=t.discountType,a=t.discountValue,c=a,d=n?i:r;return(e?Object.values(u):d).map((function(t){var n=e?t:u[t],i=n.unitPrice,r=n.quantity,d=n.variantId,s=n.productId;return"percentage"===o?(a>=100&&(c=100),{productId:s,variantId:d,quantity:r,unitPrice:(r*i-r*i*(c/100))/r}):{productId:s,variantId:d,quantity:r,unitPrice:(r*(a>=i?a:i)-a)/r}}))},i=function(t){var e=t.offerCategory,n=t.getCollectionValid,i=t.buyCollections,r=t.buyCollectionsCount,u=t.getCollections,o=t.getCollectionsCount,a=t.sanitizedLineItem,c=[],d=[],s=0,l=0;return n&&u.split(",").forEach((function(t){t&&Object.values(a).forEach((function(e){var n=e.collectionId,i=e.variantId,r=e.quantity;n===t&&(l+=r,d.push(i))}))})),i.split(",").forEach((function(t){t&&Object.values(a).forEach((function(e){var n=e.collectionId,i=e.variantId,r=e.quantity;n===t&&(s+=r,c.push(i))}))})),"volumeDiscount"===e?(n?l>=o&&s>=r:s>=r)?{buyCollectionsIdsValid:c,getCollectionsIdsValid:d}:{}:{buyCollectionsIdsValid:c,getCollectionsIdsValid:d}},r=function(t){var e=t.getCollectionValue,n=t.buyCollectionValue,i=t.sanitizedLineItem,r=t.discountType,u=t.discountValue,o=u,a=[];if(e){var c=e.buyCollectionsIdsValid,d=e.getCollectionsIdsValid;c&&c.length>0&&d&&d.length>0&&(a=c.concat(d))}else(c=n.buyCollectionsIdsValid)&&c.length>0&&(a=c);return a.map((function(t){var e=i[t],n=e.unitPrice,a=e.quantity,c=e.variantId,d=e.productId;return"percentage"===r?(u>=100&&(o=100),{productId:d,variantId:c,quantity:a,unitPrice:(a*n-a*n*(o/100))/a}):{productId:d,variantId:c,quantity:a,unitPrice:(a*(u>=n?u:n)-u)/a}}))},u=function(t){var e=t.lineItems,u=t.getRemovedProductList,o=t.offerCategory,a=t.getProductValid,c=t.getCollectionValid,d=t.collection,s=t.discountType,l=t.discountValue,f=t.buyCollections,v=t.buyCollectionsCount,y=t.getCollections,g=t.getCollectionsCount,I=t.buyProducts,m=t.getProducts,P=I.flatMap((function(t){return t.variantId})),p=m.flatMap((function(t){return t.variantId})),b=e;if(d){var C=!!c&&i({offerCategory:o,getCollectionValid:c,buyCollections:f,getCollections:y,buyCollectionsCount:v,getCollectionsCount:g,sanitizedLineItem:b}),L=!c&&i({offerCategory:o,buyCollections:f,buyCollectionsCount:v,sanitizedLineItem:b}),h=c?r({getCollectionValue:C,sanitizedLineItem:b,discountType:s,discountValue:l}):[],V=c?[]:r({buyCollectionValue:L,sanitizedLineItem:b,discountType:s,discountValue:l});return{getRemovedProductList:u,output:c?h:V}}var O=!!a&&function(t){var e=t.getProductVariantIds,n=t.sanitizedLineItem,i=t.buyProductVariantIds.every((function(t){return n[t]})),r=e.every((function(t){return n[t]}));return!(!i||!r)}({buyProductVariantIds:P,getProductVariantIds:p,sanitizedLineItem:b}),z=!a&&function(t){var e=t.sanitizedLineItem;return!!t.buyProductVariantIds.every((function(t){return e[t]}))}({buyProductVariantIds:P,sanitizedLineItem:b}),T=a&&O?n({getProductValid:a,getProductVariantIds:p,sanitizedLineItem:b,discountType:s,discountValue:l}):[],q=!a&&z?n({getProductValid:a,buyProductVariantIds:P,sanitizedLineItem:b,discountType:s,discountValue:l}):[];return{output:a?T:q,getRemovedProductList:u}},o=function(t){var e=t.buyProducts,n=t.sanitizedLineItem;return!!e.every((function(t){var e=t.variantId,i=t.count;return!!e&&n[e].quantity>=i}))},a=function(t){var e=t.getProducts,n=t.sanitizedLineItem;return e.map((function(t){var e=t.productId,i=t.variantId,r=t.count,u=n[i].quantity>=r,o=u?0:n[i].unitPrice,a={productId:e,variantId:i,quantity:n[i].quantity,unitPrice:o};return u?a:null}))},c=function(t){var e=t.cartQuantity,n=t.sanitizedLineItem,i=0;return Object.values(n).forEach((function(t){var e=t.quantity;i+=e})),i>=e},d=function(t){var e=t.getProducts,n=t.sanitizedLineItem,i=t.discountType,r=t.discountValue;return e.map((function(t){var e=t.variantId,u=t.amount,o=r,a=n[e].unitPrice*n[e].quantity>=u,c=n[e],d=c.unitPrice,s=c.quantity,l=c.productId;return a?"percentage"===i?(r>=100&&(o=100),{productId:l,variantId:e,quantity:s,unitPrice:(s*d-s*d*(o/100))/s}):{productId:l,variantId:e,quantity:s,unitPrice:(s*(r>=d?r:d)-r)/s}:void 0}))},s=function(){return s=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},s.apply(this,arguments)},l=function(t,e){var n=v(e)||[],i=t.getProducts,r=t.buyProducts;return e=f(i,r,e),s(s({},t),{lineItems:e,getRemovedProductList:n})},f=function(t,e,n){var i=t.map((function(t){return t.variantId})),r=e.map((function(t){return t.variantId}));return n=y(n),i.forEach((function(t){var e=n[t]||{},i=e.lineItemType,r=e.variantId,u=e.originalUnitPrice;r===t&&"READONLY"===i&&(n[t].unitPrice=u)})),r.forEach((function(t){var e=n[t]||{},i=e.lineItemType,r=e.variantId,u=e.originalUnitPrice;r===t&&"READONLY"===i&&(n[t].unitPrice=u)})),n},v=function(t){return t.filter((function(t){var e=t.lineItemType,n=t.originalUnitPrice;return t.unitPrice=n,"READONLY"===e}))},y=function(t){return t.reduce((function(t,e){return t[e.variantId]=e,t}),{})},g=function(t,e,n){var i=[];return"include"===n?Object.keys(t).forEach((function(n){e[n]&&i.push(t[n])})):"exclude"===n&&Object.keys(t).forEach((function(n){e[n]||i.push(t[n])})),i},I=function(t){var e=t.lineItems,n=t.includeProducts,i=t.excludeProducts,r=y(n),u=y(i),o=0!==Object.keys(r).length?g(e,r,"include"):[],a=0!==Object.keys(u).length?g(e,u,"exclude"):[],c=o.length?o:a,d=y(c);return 0!==c.length?d:e},m=function(){return m=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},m.apply(this,arguments)},P=function(t){var e=t.getOfferConfig,n=e.buyProducts,i=e.buyProductQuantity,r=function(t,e,n){for(var i=!1,r=0,u=t;r<u.length;r++){var o=u[r],a=(n[o]||{}).quantity;if(!(n[o]&&e<=a)){i=!1;break}i=!0}return{offerFlag:i}}(n.map((function(t){return t.variantId})),i,I(t)),u=function(t,e){var n=t.offerFlag,i=e.getOfferType,r=e.getOfferConfig,u=r.getProducts,o=r.getProductQuantity,a=0!==u.length?u.length:1,c=r.discount;return c="amount"===i?c/a:c,n?u.map((function(t){var e=t.unitPrice,n=0;return"product"!==i&&("percentage"===i?c>=100&&(c=100):"amount"===i&&c>=e&&(e=c),n="percentage"===i?o*e-o*e*(c/100):o*e-c),m(m({},t),{quantity:o,unitPrice:n})})):[]}(r,t);return u},p=function(){return p=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},p.apply(this,arguments)},b=function(t){var e=function(t,e){var n=t.offerFlag,i=t.total,r=e.getOfferType,u=e.getOfferConfig,o=u.threshold,a=u.getProducts,c=u.getProductQuantity,d=0!==a.length?a.length:1,s=u.discount;return s="amount"===r?s/d:s,n&&o<=i?a.map((function(t){var e=t.unitPrice,n=0;return"product"!==r&&("percentage"===r?s>=100&&(s=100):"amount"===r&&s>=e&&(e=s),n="percentage"===r?c*e-c*e*(s/100):c*e-s),p(p({},t),{quantity:c,unitPrice:n})})):[]}(function(t,e){for(var n=!1,i=0,r=0,u=t;r<u.length;r++){var o=e[u[r]]||{},a=o.quantity,c=o.unitPrice;if(!a||!c){n=!1;break}i+=a*c,n=!0}return{offerFlag:n,total:i}}(t.getOfferConfig.buyProducts.map((function(t){return t.variantId})),I(t)),t);return e},C=function(t){switch(t.getConfigSchema.offerCategory){case"percentageDiscount":return function(t){var e=t.getConfigSchema,n=t.lineItems,i=l(e,n);return u(i)}(t);case"flatDiscount":return function(t){var e=t.getConfigSchema,n=t.lineItems,i=l(e,n);return u(i)}(t);case"volumeDiscount":return function(t){var e=t.getConfigSchema,u=t.lineItems,a=function(t){var e=t.lineItems,u=t.getRemovedProductList,a=t.overAll,d=t.cartQuantity,s=t.offerCategory,l=t.getCollectionValid,f=t.collection,v=t.discountType,y=t.discountValue,g=t.buyCollections,I=t.buyCollectionsCount,m=t.buyProducts,P=e;if(a)return{getRemovedProductList:u,output:c({cartQuantity:d,sanitizedLineItem:P})?n({overAll:a,sanitizedLineItem:P,discountType:v,discountValue:y}):[]};if(f){if(f){var p=!l&&i({offerCategory:s,buyCollections:g,buyCollectionsCount:I,sanitizedLineItem:P});return{getRemovedProductList:u,output:l?[]:r({buyCollectionValue:p,sanitizedLineItem:P,discountType:v,discountValue:y})}}return{getRemovedProductList:u,output:{}}}var b=m.flatMap((function(t){return t.variantId}));return{getRemovedProductList:u,output:o({buyProducts:m,sanitizedLineItem:P})?n({buyProductVariantIds:b,sanitizedLineItem:P,discountType:v,discountValue:y}):[]}}(l(e,u));return a}(t);case"buyXGetY":return function(t){var e=t.getConfigSchema,n=t.lineItems,i=function(t){var e=t.lineItems,n=t.getRemovedProductList,i=t.onlyCartAmoutAndQunatity,r=t.cartQuantity,u=t.buyProducts,d=t.getProducts,s=e;return i?{getRemovedProductList:n,output:c({cartQuantity:r,sanitizedLineItem:s})?a({getProducts:d,sanitizedLineItem:s}):[]}:{getRemovedProductList:n,output:o({buyProducts:u,sanitizedLineItem:s})?a({getProducts:d,sanitizedLineItem:s}):[]}}(l(e,n));return i}(t);case"buyMoreSaveMore":return function(t){var e=t.getConfigSchema,n=t.lineItems;return function(t){var e=t.lineItems,n=t.getRemovedProductList,i=t.onlyCartAmoutAndQunatity,r=t.cartTotal,u=t.buyProducts,o=t.getProducts,a=t.discountType,c=t.discountValue,s=e;if(i){var l=function(t){var e=t.cartTotal,n=t.sanitizedLineItem,i=0;return Object.values(n).forEach((function(t){var e=t.unitPrice,n=t.quantity;i+=e*n})),i>=e}({cartTotal:r,sanitizedLineItem:s});return{getRemovedProductList:n,output:l?d({getProducts:o,sanitizedLineItem:s,discountType:a,discountValue:c}):[]}}var f=function(t){var e=t.sanitizedLineItem;return!!t.buyProducts.every((function(t){var n=t.variantId,i=t.amount;return!!n&&e[n].unitPrice*e[n].quantity>=i}))}({buyProducts:u,sanitizedLineItem:s});return{getRemovedProductList:n,output:f?d({getProducts:o,sanitizedLineItem:s,discountType:a,discountValue:c}):[]}}(l(e,n))}(t);default:return{}}},L=function(t,e){var n=t.cartLineItems,i=(void 0===n?{}:n).lineItems,r=function(t){switch(t.buyOfferType){case"threshold":return function(t){var e=t.getRemovedProductList;return{getSplitDiscount:b(t),getRemovedProductList:e}}(t);case"collection":case"product":default:return{};case"quantity":return function(t){var e=t.getRemovedProductList;return{getSplitDiscount:P(t),getRemovedProductList:e}}(t)}}(l(e,void 0===i?[]:i));return JSON.stringify(r)},h=function(t){return t},V=function(t,e){var n=t.cartLineItems,i=(void 0===n?{}:n).lineItems,r=C({lineItems:void 0===i?[]:i,getConfigSchema:e});return JSON.stringify(r)};vajroPlugin=e})();
//# sourceMappingURL=vajroPlugin.js.map