var vajroPlugin;(()=>{"use strict";var t={d:(e,n)=>{for(var i in n)t.o(n,i)&&!t.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:n[i]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{flow:()=>h,getBuyXGetY:()=>C,showMessage:()=>L});var n=function(t){var e=t.getProductValid,n=t.getProductVariantIds,i=t.buyProductVariantIds,r=t.sanitizedLineItem,u=t.discountType,o=t.discountValue,a=o;return(e?n:i).map((function(t){var e=r[t],n=e.unitPrice,i=e.quantity,c=e.variantId,d=e.productId;return"percentage"===u?(o>=100&&(a=100),{productId:d,variantId:c,quantity:i,unitPrice:(i*n-i*n*(a/100))/i}):{productId:d,variantId:c,quantity:i,unitPrice:(i*(o>=n?o:n)-o)/i}}))},i=function(t){var e=t.offerCategory,n=t.getCollectionValid,i=t.buyCollections,r=t.buyCollectionsCount,u=t.getCollections,o=t.getCollectionsCount,a=t.sanitizedLineItem,c=[],d=[],s=0,l=0;return n&&u.split(",").forEach((function(t){t&&Object.values(a).forEach((function(e){var n=e.collectionId,i=e.variantId,r=e.quantity;n===t&&(l+=r,d.push(i))}))})),i.split(",").forEach((function(t){t&&Object.values(a).forEach((function(e){var n=e.collectionId,i=e.variantId,r=e.quantity;n===t&&(s+=r,c.push(i))}))})),"volumeDiscount"===e?(n?l>=o&&s>=r:s>=r)?{buyCollectionsIdsValid:c,getCollectionsIdsValid:d}:{}:{buyCollectionsIdsValid:c,getCollectionsIdsValid:d}},r=function(t){var e=t.getCollectionValue,n=t.buyCollectionValue,i=t.sanitizedLineItem,r=t.discountType,u=t.discountValue,o=u,a=[];if(e){var c=e.buyCollectionsIdsValid,d=e.getCollectionsIdsValid;c&&c.length>0&&d&&d.length>0&&(a=c.concat(d))}else(c=n.buyCollectionsIdsValid)&&c.length>0&&(a=c);return a.map((function(t){var e=i[t],n=e.unitPrice,a=e.quantity,c=e.variantId,d=e.productId;return"percentage"===r?(u>=100&&(o=100),{productId:d,variantId:c,quantity:a,unitPrice:(a*n-a*n*(o/100))/a}):{productId:d,variantId:c,quantity:a,unitPrice:(a*(u>=n?u:n)-u)/a}}))},u=function(t){var e=t.lineItems,u=t.getRemovedProductList,o=t.offerCategory,a=t.getProductValid,c=t.getCollectionValid,d=t.collection,s=t.discountType,l=t.discountValue,f=t.buyCollections,y=t.buyCollectionsCount,g=t.getCollections,v=t.getCollectionsCount,I=t.buyProducts,m=t.getProducts,p=I.flatMap((function(t){return t.variantId})),P=m.flatMap((function(t){return t.variantId})),b=e;if(d){var C=!!c&&i({offerCategory:o,getCollectionValid:c,buyCollections:f,getCollections:g,buyCollectionsCount:y,getCollectionsCount:v,sanitizedLineItem:b}),L=!c&&i({offerCategory:o,buyCollections:f,buyCollectionsCount:y,sanitizedLineItem:b}),h=c?r({getCollectionValue:C,sanitizedLineItem:b,discountType:s,discountValue:l}):[],V=c?[]:r({buyCollectionValue:L,sanitizedLineItem:b,discountType:s,discountValue:l});return{getRemovedProductList:u,output:c?h:V}}var O=!!a&&function(t){var e=t.getProductVariantIds,n=t.sanitizedLineItem,i=t.buyProductVariantIds.every((function(t){return n[t]})),r=e.every((function(t){return n[t]}));return!(!i||!r)}({buyProductVariantIds:p,getProductVariantIds:P,sanitizedLineItem:b}),z=!a&&function(t){var e=t.sanitizedLineItem;return!!t.buyProductVariantIds.every((function(t){return e[t]}))}({buyProductVariantIds:p,sanitizedLineItem:b}),T=a&&O?n({getProductValid:a,getProductVariantIds:P,sanitizedLineItem:b,discountType:s,discountValue:l}):[],q=!a&&z?n({getProductValid:a,buyProductVariantIds:p,sanitizedLineItem:b,discountType:s,discountValue:l}):[];return{output:a?T:q,getRemovedProductList:u}},o=function(t){var e=t.buyProducts,n=t.sanitizedLineItem;return!!e.every((function(t){var e=t.variantId,i=t.count;return!!e&&n[e].quantity>=i}))},a=function(t){var e=t.getProducts,n=t.sanitizedLineItem;return e.map((function(t){var e=t.productId,i=t.variantId,r=t.count,u=n[i].quantity>=r,o=u?0:n[i].unitPrice,a={productId:e,variantId:i,quantity:n[i].quantity,unitPrice:o};return u?a:null}))},c=function(t){var e=t.getProducts,n=t.sanitizedLineItem,i=t.discountType,r=t.discountValue;return e.map((function(t){var e=t.variantId,u=t.amount,o=r,a=n[e].unitPrice*n[e].quantity>=u,c=n[e],d=c.unitPrice,s=c.quantity,l=c.productId;return a?"percentage"===i?(r>=100&&(o=100),{productId:l,variantId:e,quantity:s,unitPrice:(s*d-s*d*(o/100))/s}):{productId:l,variantId:e,quantity:s,unitPrice:(s*(r>=d?r:d)-r)/s}:void 0}))},d=function(){return d=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},d.apply(this,arguments)},s=function(t,e){var n=f(e)||[],i=t.getProducts,r=t.buyProducts;return e=l(i,r,e),d(d({},t),{lineItems:e,getRemovedProductList:n})},l=function(t,e,n){var i=t.map((function(t){return t.variantId})),r=e.map((function(t){return t.variantId}));return n=y(n),i.forEach((function(t){var e=n[t]||{},i=e.lineItemType,r=e.variantId,u=e.originalUnitPrice;r===t&&"READONLY"===i&&(n[t].unitPrice=u)})),r.forEach((function(t){var e=n[t]||{},i=e.lineItemType,r=e.variantId,u=e.originalUnitPrice;r===t&&"READONLY"===i&&(n[t].unitPrice=u)})),n},f=function(t){return t.filter((function(t){return"READONLY"===t.lineItemType}))},y=function(t){return t.reduce((function(t,e){return t[e.variantId]=e,t}),{})},g=function(t,e,n){var i=[];return"include"===n?Object.keys(t).forEach((function(n){e[n]&&i.push(t[n])})):"exclude"===n&&Object.keys(t).forEach((function(n){e[n]||i.push(t[n])})),i},v=function(t){var e=t.lineItems,n=t.includeProducts,i=t.excludeProducts,r=y(n),u=y(i),o=0!==Object.keys(r).length?g(e,r,"include"):[],a=0!==Object.keys(u).length?g(e,u,"exclude"):[],c=o.length?o:a,d=y(c);return 0!==c.length?d:e},I=function(){return I=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},I.apply(this,arguments)},m=function(t){var e=t.getOfferConfig,n=e.buyProducts,i=e.buyProductQuantity,r=function(t,e,n){for(var i=!1,r=0,u=t;r<u.length;r++){var o=u[r],a=(n[o]||{}).quantity;if(!(n[o]&&e<=a)){i=!1;break}i=!0}return{offerFlag:i}}(n.map((function(t){return t.variantId})),i,v(t)),u=function(t,e){var n=t.offerFlag,i=e.getOfferType,r=e.getOfferConfig,u=r.getProducts,o=r.getProductQuantity,a=0!==u.length?u.length:1,c=r.discount;return c="amount"===i?c/a:c,n?u.map((function(t){var e=t.unitPrice,n=0;return"product"!==i&&("percentage"===i?c>=100&&(c=100):"amount"===i&&c>=e&&(e=c),n="percentage"===i?o*e-o*e*(c/100):o*e-c),I(I({},t),{quantity:o,unitPrice:n})})):[]}(r,t);return u},p=function(){return p=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},p.apply(this,arguments)},P=function(t){var e=function(t,e){var n=t.offerFlag,i=t.total,r=e.getOfferType,u=e.getOfferConfig,o=u.threshold,a=u.getProducts,c=u.getProductQuantity,d=0!==a.length?a.length:1,s=u.discount;return s="amount"===r?s/d:s,n&&o<=i?a.map((function(t){var e=t.unitPrice,n=0;return"product"!==r&&("percentage"===r?s>=100&&(s=100):"amount"===r&&s>=e&&(e=s),n="percentage"===r?c*e-c*e*(s/100):c*e-s),p(p({},t),{quantity:c,unitPrice:n})})):[]}(function(t,e){for(var n=!1,i=0,r=0,u=t;r<u.length;r++){var o=e[u[r]]||{},a=o.quantity,c=o.unitPrice;if(!a||!c){n=!1;break}i+=a*c,n=!0}return{offerFlag:n,total:i}}(t.getOfferConfig.buyProducts.map((function(t){return t.variantId})),v(t)),t);return e},b=function(t){switch(t.getConfigSchema.offerCategory){case"percentageDiscount":return function(t){var e=t.getConfigSchema,n=t.lineItems,i=s(e,n);return u(i)}(t);case"flatDiscount":return function(t){var e=t.getConfigSchema,n=t.lineItems,i=s(e,n);return u(i)}(t);case"volumeDiscount":return function(t){var e=t.getConfigSchema,u=t.lineItems,a=function(t){var e=t.lineItems,u=t.getRemovedProductList,a=t.offerCategory,c=t.getCollectionValid,d=t.collection,s=t.discountType,l=t.discountValue,f=t.buyCollections,y=t.buyCollectionsCount,g=t.buyProducts,v=e;if(d){var I=!c&&i({offerCategory:a,buyCollections:f,buyCollectionsCount:y,sanitizedLineItem:v});return{getRemovedProductList:u,output:c?[]:r({buyCollectionValue:I,sanitizedLineItem:v,discountType:s,discountValue:l})}}var m=g.flatMap((function(t){return t.variantId}));return{getRemovedProductList:u,output:o({buyProducts:g,sanitizedLineItem:v})?n({buyProductVariantIds:m,sanitizedLineItem:v,discountType:s,discountValue:l}):[]}}(s(e,u));return a}(t);case"buyXGetY":return function(t){var e=t.getConfigSchema,n=t.lineItems;return function(t){var e=t.lineItems,n=t.getRemovedProductList,i=t.onlyCartAmoutAndQunatity,r=t.cartQuantity,u=t.buyProducts,c=t.getProducts,d=e;if(i){var s=function(t){var e=t.cartQuantity,n=t.sanitizedLineItem,i=0;return Object.values(n).forEach((function(t){var e=t.quantity;i+=e})),i>=e}({cartQuantity:r,sanitizedLineItem:d});return{getRemovedProductList:n,output:s?a({getProducts:c,sanitizedLineItem:d}):[]}}return{getRemovedProductList:n,output:o({buyProducts:u,sanitizedLineItem:d})?a({getProducts:c,sanitizedLineItem:d}):[]}}(s(e,n))}(t);case"buyMoreSaveMore":return function(t){var e=t.getConfigSchema,n=t.lineItems;return function(t){var e=t.lineItems,n=t.getRemovedProductList,i=t.onlyCartAmoutAndQunatity,r=t.cartTotal,u=t.buyProducts,o=t.getProducts,a=t.discountType,d=t.discountValue,s=e;if(i){var l=function(t){var e=t.cartTotal,n=t.sanitizedLineItem,i=0;return Object.values(n).forEach((function(t){var e=t.unitPrice,n=t.quantity;i+=e*n})),i>=e}({cartTotal:r,sanitizedLineItem:s});return{getRemovedProductList:n,output:l?c({getProducts:o,sanitizedLineItem:s,discountType:a,discountValue:d}):[]}}var f=function(t){var e=t.sanitizedLineItem;return!!t.buyProducts.every((function(t){var n=t.variantId,i=t.amount;return!!n&&e[n].unitPrice*e[n].quantity>=i}))}({buyProducts:u,sanitizedLineItem:s});return{getRemovedProductList:n,output:f?c({getProducts:o,sanitizedLineItem:s,discountType:a,discountValue:d}):[]}}(s(e,n))}(t);default:return{}}},C=function(t,e){var n=t.cartLineItems,i=(void 0===n?{}:n).lineItems,r=function(t){switch(t.buyOfferType){case"threshold":return function(t){var e=t.getRemovedProductList;return{getSplitDiscount:P(t),getRemovedProductList:e}}(t);case"collection":case"product":default:return{};case"quantity":return function(t){var e=t.getRemovedProductList;return{getSplitDiscount:m(t),getRemovedProductList:e}}(t)}}(s(e,void 0===i?[]:i));return JSON.stringify(r)},L=function(t){return t},h=function(t,e){var n=t.cartLineItems,i=(void 0===n?{}:n).lineItems,r=b({lineItems:void 0===i?[]:i,getConfigSchema:e});return JSON.stringify(r)};vajroPlugin=e})();
//# sourceMappingURL=vajroPlugin.js.map