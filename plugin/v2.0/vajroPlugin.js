var vajroPlugin;(()=>{"use strict";var t={d:(e,n)=>{for(var i in n)t.o(n,i)&&!t.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:n[i]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{flow:()=>C,getBuyXGetY:()=>P,showMessage:()=>b});var n=function(t){var e=t.getProductValid,n=t.getProductVariantIds,i=t.buyProductVariantIds,r=t.sanitizedLineItem,u=t.discountType,o=t.discountValue,a=o;return(e?n:i).map((function(t){var e=r[t],n=e.unitPrice,i=e.quantity,c=e.variantId,d=e.productId;return"percentage"===u?(o>=100&&(a=100),{productId:d,variantId:c,quantity:i,unitPrice:(i*n-i*n*(a/100))/i}):{productId:d,variantId:c,quantity:i,unitPrice:(i*(o>=n?o:n)-o)/i}}))},i=function(t){var e=t.offerCategory,n=t.getCollectionValid,i=t.buyCollections,r=t.buyCollectionsCount,u=t.getCollections,o=t.getCollectionsCount,a=t.sanitizedLineItem,c=[],d=[],s=0,l=0;return n&&u.split(",").forEach((function(t){t&&Object.values(a).forEach((function(e){var n=e.collectionId,i=e.variantId,r=e.quantity;n===t&&(l+=r,d.push(i))}))})),i.split(",").forEach((function(t){t&&Object.values(a).forEach((function(e){var n=e.collectionId,i=e.variantId,r=e.quantity;n===t&&(s+=r,c.push(i))}))})),"volumeDiscount"===e?(n?l>=o&&s>=r:s>=r)?{buyCollectionsIdsValid:c,getCollectionsIdsValid:d}:{}:{buyCollectionsIdsValid:c,getCollectionsIdsValid:d}},r=function(t){var e=t.getCollectionValue,n=t.buyCollectionValue,i=t.sanitizedLineItem,r=t.discountType,u=t.discountValue,o=u,a=[];if(e){var c=e.buyCollectionsIdsValid,d=e.getCollectionsIdsValid;c&&c.length>0&&d&&d.length>0&&(a=c.concat(d))}else(c=n.buyCollectionsIdsValid)&&c.length>0&&(a=c);return a.map((function(t){var e=i[t],n=e.unitPrice,a=e.quantity,c=e.variantId,d=e.productId;return"percentage"===r?(u>=100&&(o=100),{productId:d,variantId:c,quantity:a,unitPrice:(a*n-a*n*(o/100))/a}):{productId:d,variantId:c,quantity:a,unitPrice:(a*(u>=n?u:n)-u)/a}}))},u=function(t){var e=t.lineItems,u=t.getRemovedProductList,o=t.offerCategory,a=t.getProductValid,c=t.getCollectionValid,d=t.collection,s=t.discountType,l=t.discountValue,f=t.buyCollections,g=t.buyCollectionsCount,y=t.getCollections,v=t.getCollectionsCount,I=t.buyProducts,p=t.getProducts,m=I.flatMap((function(t){return t.variantId})),P=p.flatMap((function(t){return t.variantId})),b=e;if(d){var C=!!c&&i({offerCategory:o,getCollectionValid:c,buyCollections:f,getCollections:y,buyCollectionsCount:g,getCollectionsCount:v,sanitizedLineItem:b}),h=!c&&i({offerCategory:o,buyCollections:f,buyCollectionsCount:g,sanitizedLineItem:b}),L=c?r({getCollectionValue:C,sanitizedLineItem:b,discountType:s,discountValue:l}):[],V=c?[]:r({buyCollectionValue:h,sanitizedLineItem:b,discountType:s,discountValue:l});return{getRemovedProductList:u,output:c?L:V}}var O=!!a&&function(t){var e=t.getProductVariantIds,n=t.sanitizedLineItem,i=t.buyProductVariantIds.every((function(t){return n[t]})),r=e.every((function(t){return n[t]}));return!(!i||!r)}({buyProductVariantIds:m,getProductVariantIds:P,sanitizedLineItem:b}),z=!a&&function(t){var e=t.sanitizedLineItem;return!!t.buyProductVariantIds.every((function(t){return e[t]}))}({buyProductVariantIds:m,sanitizedLineItem:b}),q=a&&O?n({getProductValid:a,getProductVariantIds:P,sanitizedLineItem:b,discountType:s,discountValue:l}):[],T=!a&&z?n({getProductValid:a,buyProductVariantIds:m,sanitizedLineItem:b,discountType:s,discountValue:l}):[];return{output:a?q:T,getRemovedProductList:u}},o=function(t){var e=t.buyProducts,n=t.sanitizedLineItem;return!!e.every((function(t){var e=t.variantId,i=t.count;return!!e&&n[e].quantity>=i}))},a=function(){return a=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},a.apply(this,arguments)},c=function(t,e){var n=s(e)||[],i=t.getProducts,r=t.buyProducts;return e=d(i,r,e),a(a({},t),{lineItems:e,getRemovedProductList:n})},d=function(t,e,n){var i=t.map((function(t){return t.variantId})),r=e.map((function(t){return t.variantId}));return n=l(n),i.forEach((function(t){var e=n[t]||{},i=e.lineItemType,r=e.variantId,u=e.originalUnitPrice;r===t&&"READONLY"===i&&(n[t].unitPrice=u)})),r.forEach((function(t){var e=n[t]||{},i=e.lineItemType,r=e.variantId,u=e.originalUnitPrice;r===t&&"READONLY"===i&&(n[t].unitPrice=u)})),n},s=function(t){return t.filter((function(t){return"READONLY"===t.lineItemType}))},l=function(t){return t.reduce((function(t,e){return t[e.variantId]=e,t}),{})},f=function(t,e,n){var i=[];return"include"===n?Object.keys(t).forEach((function(n){e[n]&&i.push(t[n])})):"exclude"===n&&Object.keys(t).forEach((function(n){e[n]||i.push(t[n])})),i},g=function(t){var e=t.lineItems,n=t.includeProducts,i=t.excludeProducts,r=l(n),u=l(i),o=0!==Object.keys(r).length?f(e,r,"include"):[],a=0!==Object.keys(u).length?f(e,u,"exclude"):[],c=o.length?o:a,d=l(c);return 0!==c.length?d:e},y=function(){return y=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},y.apply(this,arguments)},v=function(t){var e=t.getOfferConfig,n=e.buyProducts,i=e.buyProductQuantity,r=function(t,e,n){for(var i=!1,r=0,u=t;r<u.length;r++){var o=u[r],a=(n[o]||{}).quantity;if(!(n[o]&&e<=a)){i=!1;break}i=!0}return{offerFlag:i}}(n.map((function(t){return t.variantId})),i,g(t)),u=function(t,e){var n=t.offerFlag,i=e.getOfferType,r=e.getOfferConfig,u=r.getProducts,o=r.getProductQuantity,a=0!==u.length?u.length:1,c=r.discount;return c="amount"===i?c/a:c,n?u.map((function(t){var e=t.unitPrice,n=0;return"product"!==i&&("percentage"===i?c>=100&&(c=100):"amount"===i&&c>=e&&(e=c),n="percentage"===i?o*e-o*e*(c/100):o*e-c),y(y({},t),{quantity:o,unitPrice:n})})):[]}(r,t);return u},I=function(){return I=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},I.apply(this,arguments)},p=function(t){var e=function(t,e){var n=t.offerFlag,i=t.total,r=e.getOfferType,u=e.getOfferConfig,o=u.threshold,a=u.getProducts,c=u.getProductQuantity,d=0!==a.length?a.length:1,s=u.discount;return s="amount"===r?s/d:s,n&&o<=i?a.map((function(t){var e=t.unitPrice,n=0;return"product"!==r&&("percentage"===r?s>=100&&(s=100):"amount"===r&&s>=e&&(e=s),n="percentage"===r?c*e-c*e*(s/100):c*e-s),I(I({},t),{quantity:c,unitPrice:n})})):[]}(function(t,e){for(var n=!1,i=0,r=0,u=t;r<u.length;r++){var o=e[u[r]]||{},a=o.quantity,c=o.unitPrice;if(!a||!c){n=!1;break}i+=a*c,n=!0}return{offerFlag:n,total:i}}(t.getOfferConfig.buyProducts.map((function(t){return t.variantId})),g(t)),t);return e},m=function(t){switch(t.getConfigSchema.offerCategory){case"percentageDiscount":return function(t){var e=t.getConfigSchema,n=t.lineItems,i=c(e,n);return u(i)}(t);case"flatDiscount":return function(t){var e=t.getConfigSchema,n=t.lineItems,i=c(e,n);return u(i)}(t);case"volumeDiscount":return function(t){var e=t.getConfigSchema,u=t.lineItems,a=function(t){var e=t.lineItems,u=t.getRemovedProductList,a=t.offerCategory,c=t.getCollectionValid,d=t.collection,s=t.discountType,l=t.discountValue,f=t.buyCollections,g=t.buyCollectionsCount,y=t.buyProducts,v=e;if(d){var I=!c&&i({offerCategory:a,buyCollections:f,buyCollectionsCount:g,sanitizedLineItem:v});return{getRemovedProductList:u,output:c?[]:r({buyCollectionValue:I,sanitizedLineItem:v,discountType:s,discountValue:l})}}var p=y.flatMap((function(t){return t.variantId}));return{getRemovedProductList:u,output:o({buyProducts:y,sanitizedLineItem:v})?n({buyProductVariantIds:p,sanitizedLineItem:v,discountType:s,discountValue:l}):[]}}(c(e,u));return a}(t);case"buyXGetY":return function(t){var e=t.getConfigSchema,n=t.lineItems,i=function(t){var e=t.lineItems,n=t.getRemovedProductList,i=t.buyProducts,r=t.getProducts,u=e,a=o({buyProducts:i,sanitizedLineItem:u})?function(t){var e=t.sanitizedLineItem;return t.getProducts.map((function(t){var n=t.productId,i=t.variantId,r=t.count,u=e[i].quantity>=r,o=u?0:e[i].unitPrice,a={productId:n,variantId:i,quantity:e[i].quantity,unitPrice:o};return u?a:null}))}({getProducts:r,sanitizedLineItem:u}):[];return{getRemovedProductList:n,output:a}}(c(e,n));return i}(t);case"buyMoreSaveMore":return function(t){var e=t.getConfigSchema,n=t.lineItems,i=function(t){var e=t.lineItems,n=t.getRemovedProductList,i=t.buyProducts,r=t.getProducts,u=t.discountType,o=t.discountValue,a=e,c=function(t){var e=t.sanitizedLineItem;return!!t.buyProducts.every((function(t){var n=t.variantId,i=t.amount;return!!n&&e[n].unitPrice*e[n].quantity>=i}))}({buyProducts:i,sanitizedLineItem:a}),d=c?function(t){var e=t.sanitizedLineItem,n=t.discountType,i=t.discountValue;return t.getProducts.map((function(t){var r=t.variantId,u=t.amount,o=i,a=e[r].unitPrice*e[r].quantity>=u,c=e[r],d=c.unitPrice,s=c.quantity,l=c.productId;return a?"percentage"===n?(i>=100&&(o=100),{productId:l,variantId:r,quantity:s,unitPrice:(s*d-s*d*(o/100))/s}):{productId:l,variantId:r,quantity:s,unitPrice:(s*(i>=d?i:d)-i)/s}:void 0}))}({getProducts:r,sanitizedLineItem:a,discountType:u,discountValue:o}):[];return{getRemovedProductList:n,output:d}}(c(e,n));return i}(t);default:return{}}},P=function(t,e){var n=t.cartLineItems,i=(void 0===n?{}:n).lineItems,r=function(t){switch(t.buyOfferType){case"threshold":return function(t){var e=t.getRemovedProductList;return{getSplitDiscount:p(t),getRemovedProductList:e}}(t);case"collection":case"product":default:return{};case"quantity":return function(t){var e=t.getRemovedProductList;return{getSplitDiscount:v(t),getRemovedProductList:e}}(t)}}(c(e,void 0===i?[]:i));return JSON.stringify(r)},b=function(t){return t},C=function(t,e){var n=t.cartLineItems,i=(void 0===n?{}:n).lineItems,r=m({lineItems:void 0===i?[]:i,getConfigSchema:e});return JSON.stringify(r)};vajroPlugin=e})();
//# sourceMappingURL=vajroPlugin.js.map