var vajroPlugin;(()=>{"use strict";var t={d:(e,n)=>{for(var r in n)t.o(n,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:n[r]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{getBuyXGetY:()=>l,showMessage:()=>g,vajroPlugins:()=>v});var n=function(){return n=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var u in e=arguments[n])Object.prototype.hasOwnProperty.call(e,u)&&(t[u]=e[u]);return t},n.apply(this,arguments)},r=function(t){return t.reduce((function(t,e){return t[e.variantId]=e,t}),{})},u=function(t,e,n){var r=[];return"include"===n?Object.keys(t).forEach((function(n){e[n]&&r.push(t[n])})):"exclude"===n&&Object.keys(t).forEach((function(n){e[n]||r.push(t[n])})),r},i=function(t){var e=t.lineItems,n=t.includeProducts,i=t.excludeProducts,o=r(n),a=r(i),c=0!==Object.keys(o).length?u(e,o,"include"):[],d=0!==Object.keys(a).length?u(e,a,"exclude"):[],f=c.length?c:d,s=r(f);return 0!==f.length?s:e},o=function(t){var e=t.getProductValid,n=t.getProductVariantIds,r=t.buyProductVariantIds,u=t.sanitizedLineItem,i=t.discountType,o=t.discountValue,a=o;return(e?n:r).map((function(t){var e=u[t],n=e.unitPrice,r=e.quantity,c=e.variantId,d=e.productId;return"percentage"===i?(o>=100&&(a=100),{productId:d,variantId:c,quantity:r,unitPrice:r*n-r*n*(a/100)}):{productId:d,variantId:c,quantity:r,unitPrice:r*(o>=n?o:n)-o}}))},a=function(){return a=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var u in e=arguments[n])Object.prototype.hasOwnProperty.call(e,u)&&(t[u]=e[u]);return t},a.apply(this,arguments)},c=function(t){var e=t.getOfferConfig,n=e.buyProducts,r=e.buyProductQuantity,u=function(t,e,n){for(var r=!1,u=0,i=t;u<i.length;u++){var o=i[u],a=(n[o]||{}).quantity;if(!(n[o]&&e<=a)){r=!1;break}r=!0}return{offerFlag:r}}(n.map((function(t){return t.variantId})),r,i(t)),o=function(t,e){var n=t.offerFlag,r=e.getOfferType,u=e.getOfferConfig,i=u.getProducts,o=u.getProductQuantity,c=0!==i.length?i.length:1,d=u.discount;return d="amount"===r?d/c:d,n?i.map((function(t){var e=t.unitPrice,n=0;return"product"!==r&&("percentage"===r?d>=100&&(d=100):"amount"===r&&d>=e&&(e=d),n="percentage"===r?o*e-o*e*(d/100):o*e-d),a(a({},t),{quantity:o,unitPrice:n})})):[]}(u,t);return o},d=function(){return d=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var u in e=arguments[n])Object.prototype.hasOwnProperty.call(e,u)&&(t[u]=e[u]);return t},d.apply(this,arguments)},f=function(t){var e=function(t,e){var n=t.offerFlag,r=t.total,u=e.getOfferType,i=e.getOfferConfig,o=i.threshold,a=i.getProducts,c=i.getProductQuantity,f=0!==a.length?a.length:1,s=i.discount;return s="amount"===u?s/f:s,n&&o<=r?a.map((function(t){var e=t.unitPrice,n=0;return"product"!==u&&("percentage"===u?s>=100&&(s=100):"amount"===u&&s>=e&&(e=s),n="percentage"===u?c*e-c*e*(s/100):c*e-s),d(d({},t),{quantity:c,unitPrice:n})})):[]}(function(t,e){for(var n=!1,r=0,u=0,i=t;u<i.length;u++){var o=e[i[u]]||{},a=o.quantity,c=o.unitPrice;if(!a||!c){n=!1;break}r+=a*c,n=!0}return{offerFlag:n,total:r}}(t.getOfferConfig.buyProducts.map((function(t){return t.variantId})),i(t)),t);return e},s=function(t){switch(t.getConfigSchema.offerCategory){case"percentageDiscount":case"flatDiscount":return function(t){return function(t){var e=t.lineItems,n=t.getConfigSchema,u=n.getProductValid,i=n.buyCollection,a=n.discountType,c=n.discountValue,d=(n.buyCollectionValue,n.buyProduct),f=n.getProduct,s=d.flatMap((function(t){return t.variantId})),l=f.flatMap((function(t){return t.variantId})),g=r(e);if(i)return{};var v=!!u&&function(t){var e=t.getProductVariantIds,n=t.sanitizedLineItem,r=t.buyProductVariantIds.every((function(t){return n[t]})),u=e.every((function(t){return n[t]}));return!(!r||!u)}({buyProductVariantIds:s,getProductVariantIds:l,sanitizedLineItem:g}),y=!u&&function(t){var e=t.sanitizedLineItem;return!!t.buyProductVariantIds.every((function(t){return e[t]}))}({buyProductVariantIds:s,sanitizedLineItem:g}),p=u&&v?o({getProductValid:u,getProductVariantIds:l,sanitizedLineItem:g,discountType:a,discountValue:c}):[],P=!u&&y?o({getProductValid:u,buyProductVariantIds:s,sanitizedLineItem:g,discountType:a,discountValue:c}):[];return u?p:P}(t)}(t);case"volumeDiscount":return function(t){var e=function(t){var e=t.lineItems,n=t.getConfigSchema,u=n.buyCollection,i=n.discountType,a=n.discountValue,c=(n.buyCollectionValue,n.buyProduct);if(u)return{};var d=c.flatMap((function(t){return t.variantId})),f=r(e),s=function(t){var e=t.sanitizedLineItem;return!!t.buyProduct.every((function(t){var n,r=t.variantId,u=t.count;return!!r&&(null===(n=e[r])||void 0===n?void 0:n.quantity)>=u}))}({buyProduct:c,sanitizedLineItem:f});return s?o({buyProductVariantIds:d,sanitizedLineItem:f,discountType:i,discountValue:a}):[]}(t);return e}(t);default:return{}}},l=function(t,e){var u,i,o,a=t.cartLineItems,d=(void 0===a?{}:a).lineItems,s=(u=e,o=function(t){return t.filter((function(t){return"READONLY"===t.lineItemType}))}(i=void 0===d?[]:d)||[],i=function(t,e){var n=t.map((function(t){return t.variantId}));return e=r(e),n.forEach((function(t){var n=e[t]||{},r=n.lineItemType;n.variantId===t&&"READONLY"===r&&delete e[t]})),e}(u.getOfferConfig.getProducts,i),n(n({},u),{lineItems:i,getRemovedProductList:o})),l=function(t){switch(t.buyOfferType){case"threshold":return function(t){var e=t.getRemovedProductList;return{getSplitDiscount:f(t),getRemovedProductList:e}}(t);case"collection":case"product":default:return{};case"quantity":return function(t){var e=t.getRemovedProductList;return{getSplitDiscount:c(t),getRemovedProductList:e}}(t)}}(s);return JSON.stringify(l)},g=function(t){return t},v=function(t,e){var n=t.cartLineItems,r=(void 0===n?{}:n).lineItems,u=s({lineItems:void 0===r?[]:r,getConfigSchema:e});return JSON.stringify(u)};vajroPlugin=e})();
//# sourceMappingURL=vajroPlugin.js.map